{"version":3,"file":"static/js/789.379849f5.chunk.js","mappings":"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","sources":["constants/medications.ts","features/medication/components/MedicationModal.tsx","features/medication/components/LogDoseModal.tsx","features/medication/hooks/useProtocolForm.ts","features/medication/components/ProtocolModal.tsx","shared/components/Button.tsx","../node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","shared/utils/medicationUtils.ts","features/medication/components/MedicationProgressBarContainer.tsx","features/medication/components/ProtocolList.tsx","features/medication/components/DisclaimerModal.tsx","features/medication/components/DeleteConfirmModal.tsx","features/medication/components/OverdueDisclaimerModal.tsx","features/medication/components/OfficialScheduleModal.tsx","features/medication/hooks/useMedicationStats.ts","features/medication/MedicationTab.tsx","features/medication/components/MedicationChart.tsx","shared/utils/medicationChartUtils.ts","shared/components/DatePicker.tsx","shared/components/CalendarPickerModal.tsx","shared/components/ChartEmptyState.tsx","shared/components/DateWheelPickerModal.tsx","shared/components/DoseWheelPickerModal.tsx","shared/components/PeriodSelector.tsx","shared/utils/calculations.ts","shared/utils/common.ts"],"sourcesContent":["export interface Medication {\n  id: string;\n  name: string;\n  defaultDose: number;\n  halfLifeHours: number;\n  titrationDoses?: number[];\n}\n\nexport const SEMAGLUTIDE_TITRATION = [0.25, 0.5, 1, 1.7, 2.4];\nexport const TIRZEPATIDE_TITRATION = [2.5, 5, 7.5, 10, 12.5, 15];\nexport const RETATRUTIDE_TITRATION = [1, 2, 4, 6, 8, 9, 12];\nexport const CAGRILINTIDE_TITRATION = [0.25, 0.5, 1, 1.5, 2.4];\n\nexport const MEDICATIONS: Medication[] = [\n  { id: 'semaglutide', name: 'Semaglutide (Ozempic/Wegovy)', defaultDose: 0.25, halfLifeHours: 168, titrationDoses: SEMAGLUTIDE_TITRATION },\n  { id: 'tirzepatide', name: 'Tirzepatide (Mounjaro/Zepbound)', defaultDose: 2.5, halfLifeHours: 127, titrationDoses: TIRZEPATIDE_TITRATION },\n  { id: 'retatrutide', name: 'Retatrutide', defaultDose: 1, halfLifeHours: 120, titrationDoses: RETATRUTIDE_TITRATION },\n  { id: 'cagrilintide', name: 'Cagrilintide (Amycretin)', defaultDose: 0.25, halfLifeHours: 168, titrationDoses: CAGRILINTIDE_TITRATION },\n  { id: 'liraglutide', name: 'Liraglutide (Victoza/Saxenda)', defaultDose: 3, halfLifeHours: 13 },\n  { id: 'dulaglutide', name: 'Dulaglutide (Trulicity)', defaultDose: 4.5, halfLifeHours: 108 },\n  { id: 'other', name: 'Custom', defaultDose: 1, halfLifeHours: 120 },\n];\n\nexport const getMedicationById = (id: string): Medication | undefined => {\n  return MEDICATIONS.find(m => m.id === id);\n};\n\nexport const generateId = (): string => {\n  return Math.random().toString(36).substr(2, 9);\n};\n\nexport const formatDate = (dateStr: string): string => {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\n};\n\nexport const formatDateShort = (dateStr: string): string => {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n};\n\nexport const formatFrequency = (frequencyPerWeek: number): string => {\n  const scheduleMap: Record<number, string> = {\n    7: 'Everyday',\n    3.5: 'Every 2 days',\n    2.333: 'Every 3 days',\n    2: 'Every 3.5 days',\n    1.75: 'Every 4 days',\n    1.4: 'Every 5 days',\n    1.167: 'Every 6 days',\n    1: 'Weekly',\n    0.5: 'Every 2 weeks',\n    0.333: 'Every 3 weeks',\n    0.233: 'Monthly',\n  };\n  return scheduleMap[frequencyPerWeek] || `${frequencyPerWeek}x/week`;\n};\n","import React, { useState, useEffect } from 'react';\nimport { MEDICATIONS } from '../../../constants/medications';\nimport { getLastDoses, saveLastDose, getLastMedication, saveLastMedication } from '../../../shared/utils/database';\nimport DateWheelPickerModal from '../../../shared/components/DateWheelPickerModal';\nimport CalendarPickerModal from '../../../shared/components/CalendarPickerModal';\nimport DoseWheelPickerModal from '../../../shared/components/DoseWheelPickerModal';\nimport { timeService } from '../../../core/timeService';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\nconst getTodayString = () => timeService.todayString();\n\ninterface MedicationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAddMedication: (dose: number, medication: string, date: string) => void;\n  useWheelForDate?: boolean;\n}\n\nconst MedicationModal: React.FC<MedicationModalProps> = ({ isOpen, onClose, onAddMedication, useWheelForDate = true }) => {\n  const { isDarkMode } = useTheme();\n  const [selectedMedication, setSelectedMedication] = useState<string>('');\n  const [dose, setDose] = useState<string>('');\n  const [selectedDate, setSelectedDate] = useState<string>(getTodayString());\n  const [showDatePicker, setShowDatePicker] = useState(false);\n  const [showDosePicker, setShowDosePicker] = useState(false);\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      setSelectedDate(getTodayString());\n      const lastMed = getLastMedication();\n      if (lastMed) {\n        setSelectedMedication(lastMed);\n      }\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (selectedMedication) {\n      const lastDoses = getLastDoses();\n      if (lastDoses[selectedMedication]) {\n        setDose(lastDoses[selectedMedication].toString());\n      } else {\n        const med = MEDICATIONS.find(m => m.id === selectedMedication);\n        if (med) setDose(med.defaultDose.toString());\n      }\n    }\n  }, [selectedMedication]);\n\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      document.body.classList.add('modal-open');\n    } else if (isVisible && !isClosing) {\n      setIsClosing(true);\n      setTimeout(() => {\n        setIsVisible(false);\n        setIsClosing(false);\n        document.body.classList.remove('modal-open');\n      }, 200);\n    }\n  }, [isOpen]);\n\n  if (!isVisible) return null;\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const doseValue = parseFloat(dose);\n    if (selectedMedication && doseValue && doseValue > 0 && doseValue < 100) {\n      saveLastMedication(selectedMedication);\n      saveLastDose(selectedMedication, doseValue);\n      onAddMedication(doseValue, selectedMedication, selectedDate);\n      setSelectedMedication('');\n      setDose('');\n      onClose();\n    }\n  };\n\n  const handleMedicationSelect = (medId: string) => {\n    setSelectedMedication(medId);\n    const lastDoses = getLastDoses();\n    if (lastDoses[medId]) {\n      setDose(lastDoses[medId].toString());\n    } else {\n      const med = MEDICATIONS.find(m => m.id === medId);\n      if (med) {\n        setDose(med.defaultDose.toString());\n      }\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4\">\n      <div \n        className={`fixed inset-0 bg-black/60 ${isClosing ? 'backdrop-fade-out' : 'backdrop-fade-in'}`}\n        style={{ backdropFilter: 'blur(8px)' }}\n        onClick={onClose}\n      />\n      <div className={`relative rounded-2xl shadow-2xl border border-[#B19CD9]/30 w-full max-w-sm p-6 max-h-[90vh] overflow-y-auto ${\n        isDarkMode \n          ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95' \n          : 'bg-white/95'\n      } ${isClosing ? 'modal-fade-out' : 'modal-content-fade-in'}`}>\n        <h2 className={`text-xl font-semibold mb-6 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Log Dose</h2>\n        <div className=\"border-t border-[#B19CD9]/20 mb-3\"></div>\n        \n        <form onSubmit={handleSubmit}>\n          <div className=\"mb-4\">\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Date\n            </label>\n            <div className=\"relative\">\n              <input\n                type=\"text\"\n                value={selectedDate}\n                readOnly\n                onClick={() => setShowDatePicker(true)}\n                className={`w-full px-3 py-2 pr-10 border rounded-lg cursor-pointer ${\n                  isDarkMode\n                    ? 'border-[#B19CD9]/30 bg-black/20 text-text-primary'\n                    : 'border-gray-300 bg-white text-gray-900'\n                }`}\n                placeholder=\"Select date\"\n              />\n              <svg\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-text-muted pointer-events-none\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                viewBox=\"0 0 24 24\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\n                />\n              </svg>\n            </div>\n          </div>\n\n          {showDatePicker && (\n            useWheelForDate ? (\n              <DateWheelPickerModal\n                isOpen={showDatePicker}\n                value={selectedDate}\n                onChange={setSelectedDate}\n                onClose={() => setShowDatePicker(false)}\n                maxDate={getTodayString()}\n              />\n            ) : (\n              <CalendarPickerModal\n                isOpen={showDatePicker}\n                value={selectedDate}\n                onChange={setSelectedDate}\n                onClose={() => setShowDatePicker(false)}\n              />\n            )\n          )}\n\n          <DoseWheelPickerModal\n            isOpen={showDosePicker}\n            onSave={(value) => {\n              setDose(value);\n              setShowDosePicker(false);\n            }}\n            onClose={() => setShowDosePicker(false)}\n            min={0}\n            max={100}\n            label=\"Select Dose (mg)\"\n            decimals={2}\n            defaultValue={dose || '0.25'}\n          />\n\n          <div className=\"mb-4\">\n            <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Medication\n            </label>\n            <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n              {MEDICATIONS.map((med) => (\n                <button\n                  key={med.id}\n                  type=\"button\"\n                  onClick={() => handleMedicationSelect(med.id)}\n                  className={`w-full text-left px-3 py-2 rounded-lg transition-all ${\n                    selectedMedication === med.id\n                      ? 'bg-[#B19CD9]/30 border border-[#B19CD9]'\n                      : isDarkMode\n                        ? 'bg-black/20 border border-transparent hover:bg-[#B19CD9]/10'\n                        : 'bg-gray-100 border border-transparent hover:bg-gray-200'\n                  }`}\n                >\n                  <span className=\"text-sm text-text-primary\">{med.name}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"mb-4\">\n            <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Dose (mg)\n            </label>\n            <button\n              type=\"button\"\n              onClick={() => setShowDosePicker(true)}\n              className={`w-full px-3 py-2 border rounded-lg text-left ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/30 bg-black/20 text-text-primary'\n                  : 'border-gray-300 bg-white text-gray-900'\n              }`}\n            >\n              {dose ? `${dose} mg` : 'Select dose'}\n            </button>\n            <p className=\"text-xs text-[#4ADEA8] mt-1\">Enter only the dose prescribed by your healthcare provider.</p>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n\n          <div className=\"flex gap-3\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white font-medium hover:shadow-[0_0_20px_rgba(177,156,217,0.5)] transition-all\"\n            >\n              Log Dose\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default MedicationModal;\n","import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { GLP1Entry, GLP1Protocol } from '../../../types';\nimport { timeService } from '../../../core/timeService';\nimport { addMedicationManualEntry } from '../../../shared/utils/database';\nimport { getMedicationColorByName } from '../../../shared/utils/chartUtils';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\ninterface LogDoseModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: () => void;\n  protocol: GLP1Protocol | null;\n  allMedications?: string[];\n}\n\nconst INJECTION_AREAS = ['Abdomen', 'Thigh', 'Arm', 'Buttock'];\nconst INJECTION_SIDES = ['Left', 'Right'];\nconst INJECTION_POSITIONS = ['Upper', 'Middle', 'Lower'];\n\nconst ISR_SEVERITY = [\n  'None',\n  'Mild',\n  'Moderate',\n  'Severe',\n];\n\nconst getPainLevelColor = (level: number): string => {\n  if (level === 0) return '#4ade80';\n  if (level <= 3) return '#facc15';\n  if (level <= 6) return '#fb923c';\n  return '#f87171';\n};\n\nconst LogDoseModal: React.FC<LogDoseModalProps> = ({ isOpen, onClose, onSave, protocol, allMedications = [] }) => {\n  const { isDarkMode } = useTheme();\n  const medicationColor = useMemo(() => {\n    if (!protocol?.medication || allMedications.length === 0) return '#B19CD9';\n    return getMedicationColorByName(protocol.medication, allMedications).stroke;\n  }, [protocol?.medication, allMedications]);\n  const [painLevel, setPainLevel] = useState<number>(0);\n  const [injectionArea, setInjectionArea] = useState<string>('');\n  const [injectionSide, setInjectionSide] = useState<string>('');\n  const [injectionPosition, setInjectionPosition] = useState<string>('');\n  const [isr, setIsr] = useState<string>('None');\n  const [notes, setNotes] = useState<string>('');\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n  const [currentTime, setCurrentTime] = useState<string>('');\n\n  const handlePainLevelChange = useCallback((value: number) => {\n    setPainLevel(value);\n  }, []);\n\n  useEffect(() => {\n    if (isOpen) {\n      const now = timeService.nowDate();\n      setCurrentTime(now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));\n      setPainLevel(0);\n      setInjectionArea('');\n      setInjectionSide('');\n      setInjectionPosition('');\n      setIsr('None');\n      setNotes('');\n      setIsVisible(true);\n      setIsClosing(false);\n      document.body.classList.add('modal-open');\n    } else if (isVisible && !isClosing) {\n      setIsClosing(true);\n      setTimeout(() => {\n        setIsVisible(false);\n        setIsClosing(false);\n        document.body.classList.remove('modal-open');\n      }, 200);\n    }\n  }, [isOpen, isVisible, isClosing]);\n\n  const painLevelColor = useMemo(() => getPainLevelColor(painLevel), [painLevel]);\n\n  if (!isVisible) return null;\n\n  const today = timeService.nowDate().toLocaleDateString('en-US', { \n    weekday: 'long', \n    year: 'numeric', \n    month: 'long', \n    day: 'numeric' \n  });\n\n  const getInjectionSiteString = () => {\n    const parts = [];\n    if (injectionSide) parts.push(injectionSide);\n    if (injectionPosition) parts.push(injectionPosition);\n    if (injectionArea) parts.push(injectionArea);\n    return parts.join(' ');\n  };\n\n  const handleSave = () => {\n    if (!protocol) return;\n\n    const todayStr = timeService.todayString();\n    const injectionSite = getInjectionSiteString();\n    \n    const newEntry: GLP1Entry = {\n      date: todayStr,\n      medication: protocol.medication,\n      dose: protocol.dose,\n      halfLifeHours: protocol.halfLifeHours,\n      isManual: true,\n      time: currentTime,\n      painLevel: painLevel > 0 ? painLevel : undefined,\n      injectionSite: injectionSite || undefined,\n      isr: isr !== 'None' ? isr : undefined,\n      notes: notes || undefined,\n    };\n\n    addMedicationManualEntry(newEntry);\n    onSave();\n    onClose();\n  };\n\n  const renderSelector = (\n    label: string,\n    options: string[],\n    selected: string,\n    onSelect: (val: string) => void,\n    cols: number = 4\n  ) => (\n    <div>\n      <label className=\"block text-sm font-medium text-text-primary mb-2\">{label}</label>\n      <div className={`grid gap-2`} style={{ gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))` }}>\n        {options.map((opt) => (\n          <button\n            key={opt}\n            type=\"button\"\n            onClick={() => onSelect(selected === opt ? '' : opt)}\n            className={`py-2 rounded-lg text-xs font-medium transition-all duration-300 transform hover:scale-[1.02] ${\n              selected === opt\n                ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white shadow-[0_0_10px_rgba(177,156,217,0.4)]'\n                : isDarkMode\n                  ? 'bg-black/20 border border-[#B19CD9]/30 text-text-muted hover:bg-[#B19CD9]/20 hover:border-[#B19CD9]/50'\n                  : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-100'\n            }`}\n          >\n            {opt}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4\">\n      <div \n        className={`fixed inset-0 bg-black/60 ${isClosing ? 'backdrop-fade-out' : 'backdrop-fade-in'}`}\n        style={{ backdropFilter: 'blur(8px)' }}\n        onClick={onClose}\n      />\n      <div className={`relative rounded-2xl shadow-2xl border border-[#B19CD9]/30 w-full max-w-sm p-6 max-h-[90vh] overflow-y-auto pointer-events-auto ${\n        isDarkMode \n          ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95' \n          : 'bg-white/95'\n      } ${isClosing ? 'modal-fade-out' : 'modal-content-fade-in'}`}>\n        <h2 className={`text-xl font-semibold mb-2 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Log Dose</h2>\n        <div className=\"border-t border-[#B19CD9]/20 mb-4\"></div>\n\n        <div className=\"space-y-3 mb-4\">\n          <div className={`rounded-lg p-3 border ${\n            isDarkMode \n              ? 'bg-black/20 border-[#B19CD9]/20' \n              : 'bg-gray-50 border-gray-200'\n          }`}>\n            <div className=\"flex justify-between items-center mb-2\">\n              <span className=\"text-sm text-text-secondary\">Medication</span>\n              <span className=\"text-sm font-medium\" style={{ color: medicationColor }}>{protocol?.medication || 'N/A'}</span>\n            </div>\n            <div className=\"flex justify-between items-center mb-2\">\n              <span className=\"text-sm text-text-secondary\">Date</span>\n              <span className=\"text-sm text-text-primary\">{today}</span>\n            </div>\n            <div className=\"flex justify-between items-center mb-2\">\n              <span className=\"text-sm text-text-secondary\">Time</span>\n              <span className=\"text-sm font-medium text-text-primary\">{currentTime}</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-sm text-text-secondary\">Dose</span>\n              <span className=\"text-sm font-medium text-[#4ADEA8]\">{protocol?.dose || 0}mg</span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t border-[#B19CD9]/20 mb-4\"></div>\n\n        <div className=\"space-y-4\">\n          <div>\n            <div className=\"flex justify-between items-center mb-2\">\n              <label className=\"text-sm font-medium text-text-secondary\">\n                Pain Level (optional)\n              </label>\n              <span className=\"pain-level-indicator text-sm font-medium\" style={{ color: painLevelColor }}>\n                {painLevel}/10\n              </span>\n            </div>\n            <div className=\"flex flex-col\">\n              <input\n                type=\"range\"\n                min=\"0\"\n                max=\"10\"\n                step=\"1\"\n                value={painLevel}\n                onChange={(e) => handlePainLevelChange(parseInt(e.target.value))}\n                className=\"pain-slider w-full h-10 appearance-none cursor-pointer\"\n              />\n              <div className=\"flex justify-between gap-1 mt-1\">\n                <span className=\"text-xs text-green-400\">None</span>\n                <span className=\"text-xs text-orange-400\">Moderate</span>\n                <span className=\"text-xs text-red-400\">Severe</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Injection Site (optional)\n            </label>\n            {renderSelector('Area', INJECTION_AREAS, injectionArea, setInjectionArea, 4)}\n            <div className=\"mt-2\">\n              {renderSelector('Side', INJECTION_SIDES, injectionSide, setInjectionSide, 2)}\n            </div>\n            <div className=\"mt-2\">\n              {renderSelector('Position', INJECTION_POSITIONS, injectionPosition, setInjectionPosition, 3)}\n            </div>\n            {getInjectionSiteString() && (\n              <div className=\"mt-3 text-center\">\n                <span className=\"text-sm bg-[#4ADEA8]/20 text-[#4ADEA8] px-3 py-1 rounded-lg\">\n                  Selected: {getInjectionSiteString()}\n                </span>\n              </div>\n            )}\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Injection Site Reaction (optional)\n            </label>\n            <div className=\"flex gap-2\">\n              {ISR_SEVERITY.map((severity) => (\n                <button\n                  key={severity}\n                  type=\"button\"\n                  onClick={() => setIsr(severity)}\n                  className={`flex-1 py-2 rounded-lg text-xs font-medium transition-all duration-300 transform hover:scale-[1.02] ${\n                    isr === severity\n                      ? severity === 'None'\n                        ? 'bg-gradient-to-r from-[#4ADEA8] to-[#6EE7B7] text-white shadow-[0_0_10px_rgba(74,222,168,0.4)]'\n                        : severity === 'Mild'\n                          ? 'bg-gradient-to-r from-[#EAB308] to-[#FACC15] text-white shadow-[0_0_10px_rgba(234,179,8,0.4)]'\n                          : severity === 'Moderate'\n                            ? 'bg-gradient-to-r from-[#F97316] to-[#FB923C] text-white shadow-[0_0_10px_rgba(249,115,22,0.4)]'\n                            : 'bg-gradient-to-r from-[#EF4444] to-[#F87171] text-white shadow-[0_0_10px_rgba(239,68,68,0.4)]'\n                      : isDarkMode\n                        ? 'bg-black/20 border border-[#B19CD9]/30 text-text-muted hover:bg-[#B19CD9]/20 hover:border-[#B19CD9]/50'\n                        : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  {severity}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-text-secondary mb-2\">\n              Notes (optional)\n            </label>\n            <textarea\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              placeholder=\"Any additional notes...\"\n              className={`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:border-[#B19CD9]/60 resize-y ${\n                isDarkMode\n                  ? 'bg-black/30 border-[#B19CD9]/30 text-text-primary placeholder-text-muted'\n                  : 'bg-white border-gray-300 text-gray-900 placeholder-gray-400'\n              }`}\n              rows={2}\n            />\n          </div>\n        </div>\n\n        <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n        <div className=\"flex gap-3\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n              isDarkMode\n                ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n            }`}\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleSave}\n            className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-[#4ADEA8] to-[#4FD99C] text-white font-medium hover:shadow-[0_0_20px_rgba(74,222,168,0.5)] transition-all\"\n          >\n            Save\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default LogDoseModal;\n","import { useState, useEffect, useMemo } from 'react';\nimport { GLP1Protocol } from '../../../types';\nimport { MEDICATIONS, generateId, Medication } from '../../../constants/medications';\nimport { timeService } from '../../../core/timeService';\n\nconst getTodayString = () => timeService.todayString();\n\nconst toLocalDateString = (date: Date): string => {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\nexport interface UseProtocolFormOptions {\n  isOpen: boolean;\n  mode: 'add' | 'edit';\n  protocol?: GLP1Protocol | null;\n  existingProtocols?: GLP1Protocol[];\n}\n\nexport interface UseProtocolFormReturn {\n  selectedMedication: string;\n  setSelectedMedication: (id: string) => void;\n  dose: string;\n  setDose: (value: string) => void;\n  frequency: string;\n  setFrequency: (value: string) => void;\n  startDate: string;\n  setStartDate: (value: string) => void;\n  stopDate: string;\n  setStopDate: (value: string) => void;\n  continuationInfo: string | null;\n  setContinuationInfo: (info: string | null) => void;\n  phase: 'titrate' | 'maintenance' | undefined;\n  setPhase: (phase: 'titrate' | 'maintenance' | undefined) => void;\n  selectedDurationDays: number;\n  setSelectedDurationDays: (days: number) => void;\n  customMedication: string;\n  setCustomMedication: (value: string) => void;\n  savedMedications: string[];\n  showOtherModal: boolean;\n  setShowOtherModal: (show: boolean) => void;\n  MAIN_MEDICATIONS: Medication[];\n  getAllMedicationIds: () => string[];\n  applyMedicationDefaults: (medicationId: string) => void;\n  handleSave: () => GLP1Protocol | null;\n  resetForm: () => void;\n}\n\nexport const useProtocolForm = ({\n  isOpen,\n  mode,\n  protocol,\n  existingProtocols,\n}: UseProtocolFormOptions): UseProtocolFormReturn => {\n  const [selectedMedication, setSelectedMedication] = useState<string>('');\n  const [dose, setDose] = useState<string>('');\n  const [frequency, setFrequency] = useState<string>('1');\n  const [startDate, setStartDate] = useState<string>(getTodayString());\n  const [stopDate, setStopDate] = useState<string>('');\n  const [continuationInfo, setContinuationInfo] = useState<string | null>(null);\n  const [phase, setPhase] = useState<'titrate' | 'maintenance' | undefined>(undefined);\n  const [selectedDurationDays, setSelectedDurationDays] = useState<number>(() => {\n    const saved = localStorage.getItem('protocolDurationDays');\n    return saved ? parseInt(saved, 10) : 28;\n  });\n  const [showOtherModal, setShowOtherModal] = useState(false);\n  const [customMedication, setCustomMedication] = useState('');\n  const [savedMedications, setSavedMedications] = useState<string[]>([]);\n\n  useEffect(() => {\n    const loadMedications = () => {\n      const mainMeds = ['Semaglutide (Ozempic/Wegovy)', 'Tirzepatide (Mounjaro/Zepbound)', 'Retatrutide'];\n      \n      if (existingProtocols && existingProtocols.length > 0) {\n        const usedMedNames = Array.from(new Set(existingProtocols.map(p => p.medication)));\n        const filteredMeds = usedMedNames.filter(m => mainMeds.includes(m) || m !== 'Semaglutide (Ozempic/Wegovy)' && m !== 'Tirzepatide (Mounjaro/Zepbound)' && m !== 'Retatrutide' && m !== 'More Options');\n        setSavedMedications(filteredMeds);\n        localStorage.setItem('usedMedications', JSON.stringify(filteredMeds));\n        return filteredMeds;\n      } else {\n        const saved = localStorage.getItem('usedMedications');\n        if (saved) {\n          const parsed = JSON.parse(saved);\n          setSavedMedications(parsed);\n          return parsed;\n        } else {\n          setSavedMedications([]);\n          return [];\n        }\n      }\n    };\n\n    if (isOpen) {\n      const loadedMeds = loadMedications();\n      \n      if (mode === 'edit' && protocol) {\n        const med = MEDICATIONS.find(m => m.name === protocol.medication);\n        if (med) {\n          setSelectedMedication(med.id);\n        } else {\n          setSelectedMedication(protocol.medication);\n        }\n        setDose(protocol.dose.toString());\n        setFrequency(protocol.frequencyPerWeek.toString());\n        setStartDate(protocol.startDate);\n        setStopDate(protocol.stopDate || '');\n        setContinuationInfo(null);\n        setPhase(protocol.phase);\n        setShowOtherModal(false);\n        setCustomMedication('');\n      } else if (mode === 'add') {\n        const savedDuration = localStorage.getItem('protocolDurationDays');\n        const durationDays = savedDuration ? parseInt(savedDuration, 10) : 28;\n        \n        if (loadedMeds && loadedMeds.length > 0) {\n          const lastMedName = loadedMeds[loadedMeds.length - 1];\n          const med = MEDICATIONS.find(m => m.name === lastMedName);\n          if (med) {\n            const medId = med.id;\n            const medData = med;\n            \n            let newDose = medData.defaultDose.toString();\n            let newStartDate = getTodayString();\n            let continuation: string | null = null;\n            let isTitration = false;\n            \n            const medProtocols = (existingProtocols || [])\n              .filter(p => p.medication === medData.name || p.medication === medId);\n            \n            if (medProtocols.length > 0) {\n              const sortedProtocols = [...medProtocols].sort((a, b) => {\n                if (!a.stopDate) return 1;\n                if (!b.stopDate) return -1;\n                return new Date(b.stopDate).getTime() - new Date(a.stopDate).getTime();\n              });\n              \n              const lastProtocol = sortedProtocols[0];\n              \n              if (lastProtocol.stopDate) {\n                const lastEndDate = new Date(lastProtocol.stopDate);\n                newStartDate = toLocalDateString(lastEndDate);\n                continuation = `Continues from ${medData.name} protocol (ended ${lastProtocol.stopDate})`;\n                \n                const endDate = new Date(newStartDate);\n                endDate.setDate(endDate.getDate() + durationDays);\n                setStopDate(toLocalDateString(endDate));\n              } else {\n                continuation = `Continues from ${medData.name} protocol (ongoing)`;\n                const endDate = new Date(newStartDate);\n                endDate.setDate(endDate.getDate() + durationDays);\n                setStopDate(toLocalDateString(endDate));\n              }\n\n              if (medData.titrationDoses) {\n                const lastDoseIndex = medData.titrationDoses.indexOf(lastProtocol.dose);\n                if (lastDoseIndex >= 0 && lastDoseIndex < medData.titrationDoses.length - 1) {\n                  newDose = medData.titrationDoses[lastDoseIndex + 1].toString();\n                  isTitration = true;\n                }\n              }\n            }\n            \n            setSelectedMedication(medId);\n            setStartDate(newStartDate);\n            setDose(newDose);\n            setContinuationInfo(continuation);\n            setPhase(isTitration ? 'titrate' : undefined);\n            setFrequency('1');\n          } else {\n            setSelectedMedication('');\n            setDose('');\n            setFrequency('1');\n            const today = getTodayString();\n            setStartDate(today);\n            const defaultEndDate = new Date(new Date(today).getTime() + durationDays * 24 * 60 * 60 * 1000);\n            setStopDate(toLocalDateString(defaultEndDate));\n            setContinuationInfo(null);\n            setPhase(undefined);\n          }\n        } else {\n          setSelectedMedication('');\n          setDose('');\n          setFrequency('1');\n          const today = getTodayString();\n          setStartDate(today);\n          const defaultEndDate = new Date(new Date(today).getTime() + durationDays * 24 * 60 * 60 * 1000);\n          setStopDate(toLocalDateString(defaultEndDate));\n          setContinuationInfo(null);\n          setPhase(undefined);\n        }\n        setShowOtherModal(false);\n        setCustomMedication('');\n      }\n    }\n  }, [isOpen, mode, protocol, existingProtocols]);\n\n  const getAllMedicationIds = () => {\n    const mainIds = ['semaglutide', 'tirzepatide', 'retatrutide'];\n    \n    const otherMeds = savedMedications.filter(name => \n      !['Semaglutide (Ozempic/Wegovy)', 'Tirzepatide (Mounjaro/Zepbound)', 'Retatrutide'].includes(name)\n    );\n    \n    const otherIds = otherMeds.map(name => {\n      const med = MEDICATIONS.find(m => m.name === name);\n      return med ? med.id : null;\n    }).filter(Boolean) as string[];\n    \n    return [...mainIds, 'other', ...otherIds];\n  };\n\n  const MAIN_MEDICATIONS = useMemo(() => {\n    return MEDICATIONS.filter(m => {\n      return getAllMedicationIds().includes(m.id);\n    }).map(med => {\n      if (med.id === 'other') {\n        return { ...med, name: 'More Options' };\n      }\n      return med;\n    });\n  }, [savedMedications]);\n\n  useEffect(() => {\n    localStorage.setItem('protocolDurationDays', selectedDurationDays.toString());\n  }, [selectedDurationDays]);\n\n  const applyMedicationDefaults = (medicationId: string) => {\n    const med = MEDICATIONS.find(m => m.id === medicationId);\n    if (!med) return;\n\n    let newDose = med.defaultDose.toString();\n    let newStartDate = getTodayString();\n    let isTitration = false;\n\n    if (mode === 'add' && existingProtocols) {\n      const medName = med.name;\n      const medProtocols = existingProtocols\n        .filter(p => p.medication === medName || p.medication === medicationId);\n      \n      if (medProtocols.length > 0) {\n        const sortedProtocols = [...medProtocols].sort((a, b) => {\n          if (!a.stopDate) return 1;\n          if (!b.stopDate) return -1;\n          return new Date(b.stopDate).getTime() - new Date(a.stopDate).getTime();\n        });\n        \n        const lastProtocol = sortedProtocols[0];\n        \n        if (lastProtocol.stopDate) {\n          const lastEndDate = new Date(lastProtocol.stopDate);\n          newStartDate = toLocalDateString(lastEndDate);\n          setContinuationInfo(`Continues from ${med.name} protocol (ended ${lastProtocol.stopDate})`);\n          \n          const endDate = new Date(newStartDate);\n          endDate.setDate(endDate.getDate() + selectedDurationDays);\n          setStopDate(toLocalDateString(endDate));\n        } else {\n          newStartDate = getTodayString();\n          setContinuationInfo(`Continues from ${med.name} protocol (ongoing)`);\n          \n          const endDate = new Date(newStartDate);\n          endDate.setDate(endDate.getDate() + selectedDurationDays);\n          setStopDate(toLocalDateString(endDate));\n        }\n\n        if (med.titrationDoses) {\n          const lastDoseIndex = med.titrationDoses.indexOf(lastProtocol.dose);\n          if (lastDoseIndex >= 0 && lastDoseIndex < med.titrationDoses.length - 1) {\n            newDose = med.titrationDoses[lastDoseIndex + 1].toString();\n            isTitration = true;\n          }\n        }\n      } else {\n        setContinuationInfo(null);\n      }\n    }\n\n    setSelectedMedication(medicationId);\n    setStartDate(newStartDate);\n    setDose(newDose);\n    setPhase(isTitration ? 'titrate' : undefined);\n  };\n\n  const handleSave = (): GLP1Protocol | null => {\n    const med = MEDICATIONS.find(m => m.id === selectedMedication);\n    \n    if (!dose || !frequency || !startDate) return null;\n    \n    let medicationName = selectedMedication;\n    let halfLife = 120;\n    \n    if (selectedMedication.startsWith('custom:')) {\n      medicationName = selectedMedication.replace('custom:', '');\n      const currentSaved = JSON.parse(localStorage.getItem('usedMedications') || '[]');\n      if (!currentSaved.includes(medicationName)) {\n        const updated = [...currentSaved, medicationName];\n        localStorage.setItem('usedMedications', JSON.stringify(updated));\n        setSavedMedications(updated);\n      }\n    } else if (med) {\n      medicationName = med.name;\n      halfLife = med.halfLifeHours;\n      const currentSaved = JSON.parse(localStorage.getItem('usedMedications') || '[]');\n      if (!currentSaved.includes(med.name)) {\n        const updated = [...currentSaved, med.name];\n        localStorage.setItem('usedMedications', JSON.stringify(updated));\n        setSavedMedications(updated);\n      }\n    } else {\n      return null;\n    }\n\n    const stopDateValue = stopDate \n      ? stopDate \n      : toLocalDateString(new Date(new Date(startDate).getTime() + 365 * 24 * 60 * 60 * 1000));\n\n    const newProtocol: GLP1Protocol = {\n      id: protocol?.id || generateId(),\n      medication: medicationName,\n      dose: parseFloat(dose),\n      frequencyPerWeek: parseInt(frequency),\n      startDate,\n      stopDate: stopDateValue,\n      halfLifeHours: halfLife,\n      phase,\n    };\n\n    return newProtocol;\n  };\n\n  const resetForm = () => {\n    setSelectedMedication('');\n    setDose('');\n    setFrequency('1');\n    setStartDate(getTodayString());\n    setStopDate('');\n    setContinuationInfo(null);\n    setPhase(undefined);\n    setShowOtherModal(false);\n    setCustomMedication('');\n  };\n\n  return {\n    selectedMedication,\n    setSelectedMedication,\n    dose,\n    setDose,\n    frequency,\n    setFrequency,\n    startDate,\n    setStartDate,\n    stopDate,\n    setStopDate,\n    continuationInfo,\n    setContinuationInfo,\n    phase,\n    setPhase,\n    selectedDurationDays,\n    setSelectedDurationDays,\n    customMedication,\n    setCustomMedication,\n    savedMedications,\n    showOtherModal,\n    setShowOtherModal,\n    MAIN_MEDICATIONS,\n    getAllMedicationIds,\n    applyMedicationDefaults,\n    handleSave,\n    resetForm,\n  };\n};\n\nexport const frequencyOptions = [\n  { value: '7', label: 'Everyday' },\n  { value: '3.5', label: 'Every 2 Days' },\n  { value: '2.333', label: 'Every 3 Days' },\n  { value: '2', label: 'Every 3.5 Days' },\n  { value: '1.75', label: 'Every 4 Days' },\n  { value: '1.4', label: 'Every 5 Days' },\n  { value: '1.167', label: 'Every 6 Days' },\n  { value: '1', label: 'Every Week' },\n  { value: '0.5', label: 'Every 2 Weeks' },\n  { value: '0.333', label: 'Every 3 Weeks' },\n  { value: '0.233', label: 'Every Month' },\n];\n\nexport const durationPresets = [\n  { label: '1W', days: 7 },\n  { label: '2W', days: 14 },\n  { label: '1M', days: 28 },\n  { label: '1Y', days: 336 },\n];\n\nexport { toLocalDateString, getTodayString };\n","import React, { useState, useEffect } from 'react';\nimport { GLP1Protocol } from '../../../types';\nimport { MEDICATIONS, Medication } from '../../../constants/medications';\nimport DateWheelPickerModal from '../../../shared/components/DateWheelPickerModal';\nimport DoseWheelPickerModal from '../../../shared/components/DoseWheelPickerModal';\nimport CalendarPickerModal from '../../../shared/components/CalendarPickerModal';\nimport BottomSheetModal from '../../../shared/components/BottomSheetModal';\nimport { useProtocolForm, frequencyOptions, durationPresets, toLocalDateString } from '../hooks/useProtocolForm';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\ninterface ProtocolModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: (protocol: GLP1Protocol) => void;\n  onArchive?: (protocol: GLP1Protocol) => void;\n  onDelete?: (id: string) => void;\n  protocol?: GLP1Protocol | null;\n  mode: 'add' | 'edit';\n  existingProtocols?: GLP1Protocol[];\n  useWheelForNumbers?: boolean;\n  useWheelForDate?: boolean;\n}\n\nconst ProtocolModal: React.FC<ProtocolModalProps> = ({ isOpen, onClose, onSave, onArchive, onDelete, protocol, mode, existingProtocols, useWheelForNumbers = true, useWheelForDate = true }) => {\n  const { isDarkMode } = useTheme();\n  const [confirmAction, setConfirmAction] = useState<'archive' | 'delete' | null>(null);\n  const [showStartDatePicker, setShowStartDatePicker] = useState(false);\n  const [showStopDatePicker, setShowStopDatePicker] = useState(false);\n  const [showDosePicker, setShowDosePicker] = useState(false);\n  const [showSchedulePicker, setShowSchedulePicker] = useState(false);\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n\n  const {\n    selectedMedication,\n    setSelectedMedication,\n    dose,\n    setDose,\n    frequency,\n    setFrequency,\n    startDate,\n    setStartDate,\n    stopDate,\n    setStopDate,\n    continuationInfo,\n    setContinuationInfo,\n    selectedDurationDays,\n    setSelectedDurationDays,\n    customMedication,\n    setCustomMedication,\n    showOtherModal,\n    setShowOtherModal,\n    MAIN_MEDICATIONS,\n    getAllMedicationIds,\n    applyMedicationDefaults,\n    handleSave: formHandleSave,\n  } = useProtocolForm({\n    isOpen,\n    mode,\n    protocol,\n    existingProtocols,\n  });\n\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      document.body.classList.add('modal-open');\n    } else if (isVisible && !isClosing) {\n      setIsClosing(true);\n      setTimeout(() => {\n        setIsVisible(false);\n        setIsClosing(false);\n        document.body.classList.remove('modal-open');\n      }, 200);\n    }\n  }, [isOpen]);\n\n  if (!isVisible) return null;\n\n  const handleMedicationSelect = (medicationId: string) => {\n    if (medicationId === 'other') {\n      setShowOtherModal(true);\n    } else {\n      applyMedicationDefaults(medicationId);\n    }\n  };\n\n  const handleSave = () => {\n    const newProtocol = formHandleSave();\n    if (newProtocol) {\n      onSave(newProtocol);\n      onClose();\n    }\n  };\n\n  const handleDurationPreset = (days: number) => {\n    setSelectedDurationDays(days);\n    if (startDate) {\n      const endDate = new Date(new Date(startDate).getTime() + days * 24 * 60 * 60 * 1000);\n      setStopDate(toLocalDateString(endDate));\n    }\n  };\n\n  const handleStartDateChange = (date: string) => {\n    setStartDate(date);\n    setContinuationInfo(null);\n    if (selectedDurationDays && date) {\n      const endDate = new Date(new Date(date).getTime() + selectedDurationDays * 24 * 60 * 60 * 1000);\n      setStopDate(toLocalDateString(endDate));\n    }\n  };\n\n  const handleCustomMedicationAdd = () => {\n    if (customMedication.trim()) {\n      setSelectedMedication('custom:' + customMedication.trim());\n      setDose('1');\n      setShowOtherModal(false);\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4\">\n      <div className={`fixed inset-0 bg-black/60 ${isClosing ? 'backdrop-fade-out' : 'backdrop-fade-in'}`} style={{ backdropFilter: 'blur(8px)' }} onClick={onClose} />\n      <div className={`relative rounded-2xl shadow-2xl border border-[#B19CD9]/30 w-full max-w-sm p-6 max-h-[90vh] overflow-y-auto ${\n        isDarkMode \n          ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95' \n          : 'bg-white/95'\n      } ${isClosing ? 'modal-fade-out' : 'modal-content-fade-in'}`}>\n        <h2 className={`text-xl font-semibold mb-6 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n          {mode === 'add' ? 'Add Custom Plan' : 'Edit Protocol'}\n        </h2>\n        <div className=\"border-t border-[#B19CD9]/20 mb-3\"></div>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Medication</label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {MAIN_MEDICATIONS.map((med) => (\n                <button\n                  key={med.id}\n                  type=\"button\"\n                  onClick={() => handleMedicationSelect(med.id)}\n                  className={`text-left px-3 py-2 rounded-lg transition-all text-sm ${\n                    selectedMedication === med.id\n                      ? 'bg-[#B19CD9]/30 border border-[#B19CD9]'\n                      : isDarkMode\n                        ? 'bg-black/20 border border-transparent hover:bg-[#B19CD9]/10'\n                        : 'bg-gray-100 border border-transparent hover:bg-gray-200'\n                  }`}\n                >\n                  <span className={isDarkMode ? 'text-text-primary' : 'text-gray-900'}>{med.name}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Dose (mg)</label>\n              {useWheelForNumbers ? (\n                <button\n                  type=\"button\"\n                  onClick={() => setShowDosePicker(true)}\n                  className={`w-full px-3 py-2 border rounded-lg text-sm text-left ${\n                    isDarkMode\n                      ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                      : 'border-gray-300 bg-white text-gray-700'\n                  }`}\n                >\n                  {dose ? `${dose} mg` : 'Select dose'}\n                </button>\n              ) : (\n                <input\n                  type=\"number\"\n                  step=\"0.25\"\n                  value={dose || ''}\n                  onChange={(e) => setDose(e.target.value)}\n                  className={`w-full px-3 py-2 border rounded-lg text-sm ${\n                    isDarkMode\n                      ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                      : 'border-gray-300 bg-white text-gray-700'\n                  }`}\n                  placeholder=\"Enter dose\"\n                />\n              )}\n            </div>\n            <div>\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Dosing Schedule</label>\n              <button\n                type=\"button\"\n                onClick={() => setShowSchedulePicker(true)}\n                className={`w-full px-3 py-2 border rounded-lg text-sm text-left ${\n                  isDarkMode\n                    ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                    : 'border-gray-300 bg-white text-gray-700'\n                }`}\n              >\n                {frequencyOptions.find(f => f.value === frequency)?.label || 'Select schedule'}\n              </button>\n            </div>\n            <p className=\"col-span-2 text-xs text-[#4ADEA8] mt-1\">Pre-filled with official label dose. Enter only the dose prescribed by your healthcare provider.</p>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Start Date</label>\n            <button\n              type=\"button\"\n              onClick={() => setShowStartDatePicker(true)}\n              className={`w-full px-3 py-2 border rounded-lg text-sm text-left ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                  : 'border-gray-300 bg-white text-gray-700'\n              }`}\n            >\n              {startDate ? new Date(startDate).toLocaleDateString() : 'Select date'}\n            </button>\n            {continuationInfo && (\n              <p className=\"text-xs text-[#4ADEA8] mt-1\">{continuationInfo}</p>\n            )}\n            <div className=\"flex gap-2 mt-2\">\n              {durationPresets.map((preset) => {\n                const isSelected = selectedDurationDays === preset.days;\n                return (\n                  <button\n                    key={preset.label}\n                    type=\"button\"\n                    onClick={() => handleDurationPreset(preset.days)}\n                    className={`flex-1 px-3 py-1 text-xs rounded-lg transition-all duration-300 ${\n                      isSelected \n                        ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white shadow-[0_0_15px_rgba(177,156,217,0.4)]'\n                        : isDarkMode\n                          ? 'bg-[#B19CD9]/10 text-[#B19CD9] border border-[#B19CD9]/30 hover:bg-[#B19CD9]/20 hover:shadow-[0_0_10px_rgba(177,156,217,0.3)]'\n                          : 'bg-gray-200 text-gray-700 border border-gray-300 hover:bg-gray-300'\n                    }`}\n                  >\n                    {preset.label}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>End Date</label>\n            <button\n              type=\"button\"\n              onClick={() => setShowStopDatePicker(true)}\n              className={`w-full px-3 py-2 border rounded-lg text-sm text-left ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                  : 'border-gray-300 bg-white text-gray-700'\n              }`}\n            >\n              {stopDate ? new Date(stopDate).toLocaleDateString() : 'Select date'}\n            </button>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n\n          <div className=\"flex gap-2\">\n            {mode === 'edit' && onDelete && onArchive && !confirmAction && (\n              <>\n                <button\n                  onClick={() => setConfirmAction('archive')}\n                  className={`flex-1 px-4 py-2 rounded-lg border transition-all text-sm ${\n                    isDarkMode\n                      ? 'border-[#B19CD9]/30 text-white hover:bg-[#B19CD9]/10'\n                      : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  Archive\n                </button>\n                <button\n                  onClick={() => setConfirmAction('delete')}\n                  className=\"flex-1 px-4 py-2 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/10 transition-all text-sm\"\n                >\n                  Delete\n                </button>\n              </>\n            )}\n            {mode === 'edit' && confirmAction && (\n              <>\n                <button\n                  onClick={() => {\n                    if (protocol && confirmAction === 'archive' && onArchive) {\n                      onArchive(protocol);\n                    }\n                    if (protocol && confirmAction === 'delete' && onDelete) {\n                      onDelete(protocol.id);\n                    }\n                    onClose();\n                  }}\n                  className=\"flex-1 px-4 py-2 rounded-lg border border-red-500/30 text-red-400 hover:bg-red-500/10 transition-all text-sm\"\n                >\n                  Yes, {confirmAction}\n                </button>\n                <button\n                  onClick={() => setConfirmAction(null)}\n                  className={`flex-1 px-4 py-2 rounded-lg border transition-all text-sm ${\n                    isDarkMode\n                      ? 'border-[#B19CD9]/30 text-white hover:bg-[#B19CD9]/10'\n                      : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n                  }`}\n                >\n                  Cancel\n                </button>\n              </>\n            )}\n            {mode === 'add' && (\n              <button\n                onClick={onClose}\n                className={`flex-1 px-4 py-2 rounded-lg border transition-all text-sm ${\n                  isDarkMode\n                    ? 'border-[#B19CD9]/30 text-white hover:bg-[#B19CD9]/10'\n                    : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n                }`}\n              >\n                Cancel\n              </button>\n            )}\n            {!confirmAction && (\n              <button\n                onClick={handleSave}\n                className={`${mode === 'edit' ? 'flex-1' : 'flex-1'} bg-gradient-to-r from-accent-purple-light to-accent-purple-medium text-white py-2 px-4 rounded-lg hover:shadow-theme transition-all text-sm`}\n              >\n                Save\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {showOtherModal && (\n        <div className=\"fixed inset-0 z-[10000] flex items-center justify-center p-4\">\n          <div className={`fixed inset-0 bg-black/60 ${showOtherModal ? 'backdrop-fade-in' : 'backdrop-fade-out'}`} style={{ backdropFilter: 'blur(8px)' }} onClick={() => setShowOtherModal(false)} />\n          <div className={`relative rounded-2xl shadow-2xl border border-[#B19CD9]/30 w-full max-w-xs p-6 max-h-[90vh] overflow-y-auto ${\n            isDarkMode \n              ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95' \n              : 'bg-white/95'\n          } modal-content-fade-in`}>\n            <h3 className={`text-lg font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Select Medication</h3>\n            <div className=\"space-y-2 mb-4\">\n              {MEDICATIONS.filter(m => !getAllMedicationIds().includes(m.id) || m.id === 'other').map((med: Medication) => (\n                <button\n                  key={med.id}\n                  type=\"button\"\n                  onClick={() => {\n                    applyMedicationDefaults(med.id);\n                    setShowOtherModal(false);\n                  }}\n                  className={`w-full text-left px-3 py-2 rounded-lg transition-all text-sm ${\n                    selectedMedication === med.id\n                      ? 'bg-[#B19CD9]/30 border border-[#B19CD9]'\n                      : isDarkMode\n                        ? 'bg-black/20 border border-transparent hover:bg-[#B19CD9]/10'\n                        : 'bg-gray-100 border border-transparent hover:bg-gray-200'\n                  }`}\n                >\n                  <span className={isDarkMode ? 'text-text-primary' : 'text-gray-900'}>{med.name}</span>\n                </button>\n              ))}\n            </div>\n            <div className=\"border-t border-[#B19CD9]/20 pt-4\">\n              <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-[#B19CD9]' : 'text-[#9C7BD3]'}`}>Or enter custom medication</label>\n              <input\n                type=\"text\"\n                value={customMedication}\n                onChange={(e) => setCustomMedication(e.target.value)}\n                placeholder=\"Custom medication name\"\n                className={`w-full px-3 py-2 border rounded-lg text-sm mb-2 ${\n                  isDarkMode\n                    ? 'border-[#B19CD9]/30 bg-black/20 text-white'\n                    : 'border-gray-300 bg-white text-gray-900'\n                }`}\n              />\n              <button\n                onClick={handleCustomMedicationAdd}\n                disabled={!customMedication.trim()}\n                className=\"w-full bg-gradient-to-r from-accent-purple-light to-accent-purple-medium text-white py-2 px-4 rounded-lg hover:shadow-theme transition-all text-sm disabled:opacity-50\"\n              >\n                Add Custom\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showStartDatePicker && (\n        useWheelForDate ? (\n          <DateWheelPickerModal\n            isOpen={showStartDatePicker}\n            value={startDate}\n            onChange={handleStartDateChange}\n            onClose={() => setShowStartDatePicker(false)}\n          />\n        ) : (\n          <CalendarPickerModal\n            isOpen={showStartDatePicker}\n            value={startDate}\n            onChange={handleStartDateChange}\n            onClose={() => setShowStartDatePicker(false)}\n          />\n        )\n      )}\n\n      {showStopDatePicker && (\n        useWheelForDate ? (\n          <DateWheelPickerModal\n            isOpen={showStopDatePicker}\n            value={stopDate}\n            onChange={(date) => setStopDate(date)}\n            onClose={() => setShowStopDatePicker(false)}\n          />\n        ) : (\n          <CalendarPickerModal\n            isOpen={showStopDatePicker}\n            value={stopDate}\n            onChange={(date) => setStopDate(date)}\n            onClose={() => setShowStopDatePicker(false)}\n          />\n        )\n      )}\n\n      {showDosePicker && (\n        <DoseWheelPickerModal\n          isOpen={showDosePicker}\n          onSave={(value) => {\n            setDose(value);\n            setShowDosePicker(false);\n          }}\n          onClose={() => setShowDosePicker(false)}\n          min={0}\n          max={100}\n          label=\"Select Dose (mg)\"\n          decimals={2}\n          defaultValue={dose || '0.25'}\n        />\n      )}\n\n      <BottomSheetModal\n        isOpen={showSchedulePicker}\n        title=\"Dosing Schedule\"\n        options={frequencyOptions}\n        value={frequency}\n        onSelect={(val) => {\n          setFrequency(String(val));\n          setShowSchedulePicker(false);\n        }}\n        onClose={() => setShowSchedulePicker(false)}\n      />\n    </div>\n  );\n};\n\nexport default ProtocolModal;\n","import React, { memo } from 'react';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'accent' | 'mint';\n  size?: 'sm' | 'md' | 'lg';\n  fullWidth?: boolean;\n}\n\nconst Button: React.FC<ButtonProps> = ({ \n  variant = 'accent', \n  size = 'md',\n  fullWidth = false,\n  className = '', \n  children,\n  ...props \n}) => {\n  const baseClasses = \"rounded-lg transition-all duration-300 transform hover:scale-[1.02]\";\n  \n  const variantClasses = {\n    primary: \"bg-gradient-to-r from-accent-purple-light to-accent-purple-medium text-white shadow-theme hover:shadow-theme-lg hover:from-accent-purple-dark hover:to-accent-purple-medium\",\n    accent: \"bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white shadow-[0_0_10px_rgba(177,156,217,0.4)]\",\n    mint: \"bg-gradient-to-r from-[#4ADEA8] to-[#4FD99C] text-white shadow-[0_0_15px_rgba(74,222,168,0.4)]\"\n  };\n\n  const sizeClasses = {\n    sm: \"px-3 py-1 text-xs\",\n    md: \"px-4 py-2\", \n    lg: \"px-6 py-3 text-lg\"\n  };\n\n  return (\n    <button \n      className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${fullWidth ? 'w-full' : ''} ${className}`}\n      {...props}\n    >\n      {children}\n    </button>\n  );\n};\n\nexport default memo(Button);","import objectWithoutPropertiesLoose from \"./objectWithoutPropertiesLoose.js\";\nfunction _objectWithoutProperties(e, t) {\n  if (null == e) return {};\n  var o,\n    r,\n    i = objectWithoutPropertiesLoose(e, t);\n  if (Object.getOwnPropertySymbols) {\n    var n = Object.getOwnPropertySymbols(e);\n    for (r = 0; r < n.length; r++) o = n[r], -1 === t.indexOf(o) && {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]);\n  }\n  return i;\n}\nexport { _objectWithoutProperties as default };","function _objectWithoutPropertiesLoose(r, e) {\n  if (null == r) return {};\n  var t = {};\n  for (var n in r) if ({}.hasOwnProperty.call(r, n)) {\n    if (-1 !== e.indexOf(n)) continue;\n    t[n] = r[n];\n  }\n  return t;\n}\nexport { _objectWithoutPropertiesLoose as default };","export type MedicationKey = 'semaglutide' | 'tirzepatide' | 'retatrutide' | 'cagrilintide';\n\nexport const CANONICAL_MEDICATIONS: Record<MedicationKey, string[]> = {\n  semaglutide: ['semaglutide', 'ozempic', 'wegovy'],\n  tirzepatide: ['tirzepatide', 'mounjaro', 'zepbound'],\n  retatrutide: ['retatrutide'],\n  cagrilintide: ['cagrilintide', 'amycretin'],\n};\n\nexport const MEDICATION_KEYS: MedicationKey[] = ['semaglutide', 'tirzepatide', 'retatrutide', 'cagrilintide'];\n\nexport const normalizeMedName = (name: string): MedicationKey | null => {\n  const lower = name.toLowerCase();\n  \n  for (const [key, variants] of Object.entries(CANONICAL_MEDICATIONS)) {\n    if (variants.some(v => lower.includes(v))) {\n      return key as MedicationKey;\n    }\n  }\n  \n  return null;\n};\n\nexport const isMedicationMatch = (name: string, key: MedicationKey): boolean => {\n  const normalized = normalizeMedName(name);\n  return normalized === key;\n};\n\nexport const getMedicationDisplayName = (key: MedicationKey): string => {\n  const names: Record<MedicationKey, string> = {\n    semaglutide: 'Semaglutide',\n    tirzepatide: 'Tirzepatide',\n    retatrutide: 'Retatrutide',\n    cagrilintide: 'Cagrilintide',\n  };\n  return names[key];\n};\n","import React, { useMemo } from 'react';\nimport { GLP1Entry, GLP1Protocol } from '../../../types';\nimport { MedicationStats } from '../hooks/useMedicationStats';\nimport { timeService } from '../../../core/timeService';\nimport { getMedicationColorByName } from '../../../shared/utils/chartUtils';\nimport { normalizeMedName, MedicationKey, MEDICATION_KEYS } from '../../../shared/utils/medicationUtils';\n\ninterface MedicationProgressBarContainerProps {\n  medicationEntries: GLP1Entry[];\n  protocols: GLP1Protocol[];\n  currentTime: Date;\n  latestDoseDone: number | null;\n  medicationName: string;\n  onLogDose: () => void;\n  isLogging: boolean;\n  allMedications: string[];\n}\n\nconst calculateMedicationStats = (\n  medicationEntries: GLP1Entry[],\n  protocols: GLP1Protocol[],\n  currentTime: Date,\n  latestDoseDone: number | null,\n  medicationName: string\n): { stats: MedicationStats; activeProtocol: GLP1Protocol | undefined; doseLoggedToday: boolean } => {\n  const toLocalDateStr = (d: Date): string => {\n    const year = d.getFullYear();\n    const month = String(d.getMonth() + 1).padStart(2, '0');\n    const day = String(d.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  };\n\n  const parseYmd = (ymd: string) => {\n    const [y, m, d] = ymd.split('-').map(Number);\n    return new Date(y, m - 1, d).getTime();\n  };\n\n  const computePerMedStats = (\n    entries: GLP1Entry[],\n    time: Date\n  ) => {\n    const stats: Record<MedicationKey, { isOverdue: boolean; daysSinceLastDose: number; entryToday: boolean }> = {\n      semaglutide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n      tirzepatide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n      retatrutide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n      cagrilintide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n    };\n\n    const timeDate = new Date(time);\n    const todayStr = toLocalDateStr(timeDate);\n    const todayLocal = new Date(timeDate.getFullYear(), timeDate.getMonth(), timeDate.getDate());\n\n    for (const key of MEDICATION_KEYS) {\n      const medEntries = entries.filter(\n        e => normalizeMedName(e.medication) === key && e.isManual\n      );\n\n      if (medEntries.length === 0) {\n        stats[key] = { isOverdue: false, daysSinceLastDose: 0, entryToday: false };\n        continue;\n      }\n\n      const sorted = [...medEntries].sort(\n        (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n      );\n      const lastEntry = sorted[0];\n      if (!lastEntry) continue;\n\n      const [y, m, d] = lastEntry.date.split('-').map(Number);\n      const lastDateLocal = new Date(y, m - 1, d);\n      const daysDiff = Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n\n      stats[key] = {\n        isOverdue: daysDiff >= 8,\n        daysSinceLastDose: daysDiff,\n        entryToday: medEntries.some(e => e.date === todayStr),\n      };\n    }\n\n    return stats;\n  };\n\n  const currentTimeDate = new Date(currentTime);\n  const todayStr = toLocalDateStr(currentTimeDate);\n\n  const filteredProtocols = protocols?.filter(p => p.medication === medicationName && !p.isArchived);\n  const filteredEntries = medicationEntries.filter(e => e.medication === medicationName);\n\n  const activeProtocol = filteredProtocols?.find(p => {\n    const start = p.startDate;\n    const end = p.stopDate || '2099-12-31';\n    return todayStr >= start && todayStr <= end;\n  });\n\n  let intervalDays = 7;\n  if (activeProtocol) {\n    intervalDays = Math.round(7 / activeProtocol.frequencyPerWeek);\n  }\n\n  const sortedEntries = [...filteredEntries].sort((a, b) =>\n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n\n  let lastScheduledDate: Date | null = null;\n  let nextDueDays = 0;\n  let nextDueHours = 0;\n  let nextDueMinutes = 0;\n  let nextDueSeconds = 0;\n  let daysSinceLastDose = 0;\n  let nextDueDateStr = 'N/A';\n  let nextDoseDate: Date | null = null;\n\n  const protocolStartDate = activeProtocol?.startDate || '';\n  const todayTimestamp = currentTimeDate.getTime();\n\n  if (activeProtocol && protocolStartDate) {\n    const startTimestamp = parseYmd(protocolStartDate);\n    const todayTimestampMidnight = parseYmd(todayStr);\n    const intervalMs = intervalDays * 24 * 60 * 60 * 1000;\n\n    const daysSinceStart = Math.floor((todayTimestampMidnight - startTimestamp) / (24 * 60 * 60 * 1000));\n\n    const fullIntervalsPassed = Math.floor(daysSinceStart / intervalDays);\n    const dayWithinInterval = daysSinceStart % intervalDays;\n\n    const nextDoseTimestamp = startTimestamp + (fullIntervalsPassed + (dayWithinInterval === 0 ? 0 : 1)) * intervalMs;\n    const lastDoseTimestamp = nextDoseTimestamp - intervalMs;\n\n    lastScheduledDate = new Date(lastDoseTimestamp);\n    nextDoseDate = new Date(nextDoseTimestamp);\n\n    daysSinceLastDose = (currentTimeDate.getTime() - lastDoseTimestamp) / (24 * 60 * 60 * 1000);\n\n    const diffMs = nextDoseTimestamp - todayTimestamp;\n    nextDueDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n    nextDueHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n    nextDueMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    nextDueSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);\n\n    nextDueDateStr = nextDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  }\n\n  const lastDoseDate = lastScheduledDate;\n  const lastDoseDateStr = lastDoseDate\n    ? lastDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n    : 'N/A';\n\n  if (!activeProtocol && lastDoseDate) {\n    daysSinceLastDose = (currentTimeDate.getTime() - lastDoseDate.getTime()) / (1000 * 60 * 60 * 24);\n\n    nextDoseDate = new Date(lastDoseDate.getTime() + (intervalDays * 24 * 60 * 60 * 1000));\n    nextDueDateStr = nextDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n\n    const diffMs = nextDoseDate.getTime() - currentTimeDate.getTime();\n    nextDueDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n    nextDueHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n    nextDueMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    nextDueSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);\n\n    if (diffMs < 0 && nextDueDays === 0) {\n      nextDueHours = Math.ceil(diffMs / (1000 * 60 * 60));\n      if (nextDueHours < 0) {\n        nextDueDays = -1;\n        nextDueHours = 24 + nextDueHours;\n      }\n    }\n  }\n\n  const totalDoses = filteredEntries.length;\n  const totalCurrentDose = filteredEntries.length > 0 ? filteredEntries[0].dose : 0;\n\n  const thisMonthDoses = filteredEntries.filter(entry => {\n    const entryDate = new Date(entry.date);\n    return entryDate.getMonth() === currentTimeDate.getMonth() &&\n           entryDate.getFullYear() === currentTimeDate.getFullYear();\n  }).length;\n\n  const upcomingDoses = (() => {\n    if (!filteredProtocols || filteredProtocols.length === 0) return 0;\n\n    const nextMonth = new Date(currentTimeDate);\n    nextMonth.setMonth(nextMonth.getMonth() + 1);\n\n    let count = 0;\n    filteredProtocols.forEach(protocol => {\n      const start = new Date(protocol.startDate);\n      const end = protocol.stopDate ? new Date(protocol.stopDate) : nextMonth;\n      const interval = 7 / protocol.frequencyPerWeek;\n\n      let d = new Date(start);\n      while (d <= end && d <= nextMonth) {\n        if (d > currentTimeDate) count++;\n        d = new Date(d.getTime() + interval * 24 * 60 * 60 * 1000);\n      }\n    });\n    return count;\n  })();\n\n  const isScheduleStartDay = !!(activeProtocol && activeProtocol.startDate === todayStr);\n\n  const nextDoseDateAtMidnight = nextDoseDate ? toLocalDateStr(nextDoseDate) : null;\n  const isDueToday = nextDoseDateAtMidnight === todayStr;\n\n  const perMedStats = computePerMedStats(medicationEntries, currentTime);\n\n  const stats: MedicationStats = {\n    totalDoses,\n    currentDoses: [],\n    totalCurrentDose,\n    nextDueDays,\n    nextDueHours,\n    nextDueMinutes,\n    nextDueSeconds,\n    nextDueDateStr,\n    currentLevel: 0,\n    thisMonth: thisMonthDoses,\n    plannedDoses: upcomingDoses,\n    lastDoseDateStr,\n    daysSinceLastDose,\n    intervalDays,\n    isScheduleStartDay,\n    isDueToday,\n    latestDoseDone,\n    isOverdue: (() => {\n      if (filteredEntries.length === 0) return false;\n      const sortedEntries = [...filteredEntries].sort((a, b) => \n        new Date(b.date).getTime() - new Date(a.date).getTime()\n      );\n      const lastEntry = sortedEntries[0];\n      if (!lastEntry) return false;\n      const lastDate = new Date(lastEntry.date);\n      const lastDateLocal = new Date(lastDate.getFullYear(), lastDate.getMonth(), lastDate.getDate());\n      const todayLocal = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate());\n      const daysDiff = Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n      return daysDiff >= 8;\n    })(),\n    actualDaysSinceLastDose: (() => {\n      if (filteredEntries.length === 0) return 0;\n      const sortedEntries = [...filteredEntries].sort((a, b) => \n        new Date(b.date).getTime() - new Date(a.date).getTime()\n      );\n      const lastEntry = sortedEntries[0];\n      if (!lastEntry) return 0;\n      const lastDate = new Date(lastEntry.date);\n      const lastDateLocal = new Date(lastDate.getFullYear(), lastDate.getMonth(), lastDate.getDate());\n      const todayLocal = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate());\n      return Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n    })(),\n    semaglutideIsOverdue: perMedStats.semaglutide.isOverdue,\n    tirzepatideIsOverdue: perMedStats.tirzepatide.isOverdue,\n    retatrutideIsOverdue: perMedStats.retatrutide.isOverdue,\n    cagrilintideIsOverdue: perMedStats.cagrilintide.isOverdue,\n    semaglutideEntryToday: perMedStats.semaglutide.entryToday,\n    tirzepatideEntryToday: perMedStats.tirzepatide.entryToday,\n    retatrutideEntryToday: perMedStats.retatrutide.entryToday,\n    cagrilintideEntryToday: perMedStats.cagrilintide.entryToday,\n    semaglutideDaysSinceLastDose: perMedStats.semaglutide.daysSinceLastDose,\n    tirzepatideDaysSinceLastDose: perMedStats.tirzepatide.daysSinceLastDose,\n    retatrutideDaysSinceLastDose: perMedStats.retatrutide.daysSinceLastDose,\n    cagrilintideDaysSinceLastDose: perMedStats.cagrilintide.daysSinceLastDose,\n  };\n\n  const todayStr2 = timeService.todayString();\n  const doseLoggedToday = filteredEntries.some(entry => entry.date === todayStr2 && entry.isManual);\n\n  return { stats, activeProtocol, doseLoggedToday };\n};\n\nconst MedicationProgressBar = React.lazy(() => import('./MedicationProgressBar'));\n\nexport const MedicationProgressBarContainer: React.FC<MedicationProgressBarContainerProps> = ({\n  medicationEntries,\n  protocols,\n  currentTime,\n  latestDoseDone,\n  medicationName,\n  onLogDose,\n  isLogging,\n  allMedications,\n}) => {\n  const { stats, activeProtocol, doseLoggedToday } = useMemo(\n    () => calculateMedicationStats(medicationEntries, protocols, currentTime, latestDoseDone, medicationName),\n    [medicationEntries, protocols, currentTime, latestDoseDone, medicationName]\n  );\n\n  const medicationColor = useMemo(\n    () => getMedicationColorByName(medicationName, allMedications),\n    [medicationName, allMedications]\n  );\n\n  return (\n    <React.Suspense fallback={<div className=\"h-12 bg-black/30 animate-pulse rounded-xl\"></div>}>\n      <MedicationProgressBar\n        stats={stats}\n        doseLoggedToday={doseLoggedToday}\n        currentTime={currentTime}\n        onLogDose={onLogDose}\n        isLogging={isLogging}\n        medicationName={medicationName}\n        medicationColor={medicationColor}\n        activeProtocol={activeProtocol}\n      />\n    </React.Suspense>\n  );\n};\n\nexport default MedicationProgressBarContainer;\n","import React from 'react';\nimport { GLP1Protocol } from '../../../types';\nimport { MEDICATIONS, formatDateShort, formatFrequency } from '../../../constants/medications';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\ninterface ProtocolListProps {\n  protocols: GLP1Protocol[];\n  collapsedMedications: Set<string>;\n  onToggleMedication: (medicationName: string) => void;\n  onEditProtocol: (protocol: GLP1Protocol) => void;\n  onDeleteClick: (medicationName: string) => void;\n}\n\ninterface GroupedProtocols {\n  [medicationName: string]: GLP1Protocol[];\n}\n\nconst ProtocolList: React.FC<ProtocolListProps> = ({\n  protocols,\n  collapsedMedications,\n  onToggleMedication,\n  onEditProtocol,\n  onDeleteClick,\n}) => {\n  const { isDarkMode } = useTheme();\n  if (protocols.length === 0) return null;\n\n  const groupedProtocols = protocols.reduce((acc, protocol) => {\n    const med = MEDICATIONS.find(m => m.id === protocol.medication);\n    const medName = med?.name || protocol.medication;\n    if (!acc[medName]) {\n      acc[medName] = [];\n    }\n    acc[medName].push(protocol);\n    return acc;\n  }, {} as GroupedProtocols);\n\n  return (\n    <div className=\"space-y-3 mb-4\">\n      {Object.entries(groupedProtocols).map(([medicationName, medProtocols]) => {\n        const isExpanded = !collapsedMedications.has(medicationName);\n        return (\n          <div \n            key={medicationName}\n            className={`rounded-lg p-3 border ${\n              isDarkMode \n                ? 'bg-black/20 border-[#B19CD9]/20' \n                : 'bg-gray-50 border-gray-200'\n            }`}\n          >\n            <button \n              onClick={() => onToggleMedication(medicationName)}\n              className=\"w-full flex items-center justify-between mb-2\"\n            >\n              <div className=\"text-left\">\n                <p className={`text-base font-medium ${isDarkMode ? 'text-text-primary' : 'text-gray-900'}`}>{medicationName}</p>\n                <p className={`text-sm ${isDarkMode ? 'text-text-muted' : 'text-gray-600'}`}>{formatFrequency(medProtocols[0].frequencyPerWeek)}</p>\n              </div>\n              <svg \n                className={`w-5 h-5 text-text-muted transition-transform ${isExpanded ? 'rotate-180' : ''}`} \n                fill=\"none\" \n                stroke=\"currentColor\" \n                viewBox=\"0 0 24 24\"\n              >\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n            {isExpanded && (\n              <div className=\"space-y-1\">\n                {medProtocols.map((protocol, index) => (\n                  <div key={protocol.id}>\n                    <div className=\"flex items-start justify-between gap-2 py-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className={`text-sm font-medium whitespace-nowrap ${isDarkMode ? 'text-text-primary' : 'text-gray-900'}`}>\n                          {protocol.dose}mg\n                        </span>\n                        {protocol.phase === 'titrate' && (\n                          <span className=\"text-[#4ADEA8]\">\n                            <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                            </svg>\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <span className={`text-sm whitespace-nowrap ${isDarkMode ? 'text-text-muted' : 'text-gray-600'}`}>\n                          {formatDateShort(protocol.startDate)}  {protocol.stopDate ? formatDateShort(protocol.stopDate) : 'Ongoing'}\n                        </span>\n                        <button\n                          onClick={() => onEditProtocol(protocol)}\n                          className=\"text-sm text-accent-purple-light hover:text-accent-purple-medium\"\n                        >\n                          Edit\n                        </button>\n                      </div>\n                    </div>\n                    {index < medProtocols.length - 1 && (\n                      <div className={`border-b ${isDarkMode ? 'border-[#B19CD9]/20' : 'border-gray-200'}`}></div>\n                    )}\n                  </div>\n                ))}\n                <button\n                  onClick={() => onDeleteClick(medicationName)}\n                  className={`mt-2 px-2 py-1 text-xs border rounded transition-all ${\n                    isDarkMode\n                      ? 'text-red-400 hover:text-red-500 border-red-500/30 hover:bg-red-500/10'\n                      : 'text-red-600 hover:text-red-700 border-red-300 hover:bg-red-50'\n                  }`}\n                >\n                  Delete\n                </button>\n              </div>\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport default ProtocolList;\n","import React, { useState, useEffect } from 'react';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\ninterface DisclaimerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onAcknowledged: () => void;\n}\n\nconst DisclaimerModal: React.FC<DisclaimerModalProps> = ({ isOpen, onClose, onAcknowledged }) => {\n  const { isDarkMode } = useTheme();\n  const [acknowledged, setAcknowledged] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      setAcknowledged(false);\n    }\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleContinue = () => {\n    localStorage.setItem('glpal_disclaimer_acknowledged', 'true');\n    onAcknowledged();\n  };\n\n  return (\n    <div \n      className=\"fixed inset-0 z-[10001] flex items-center justify-center p-4\"\n      style={{ animation: 'fadeIn 0.2s ease-out' }}\n    >\n      <div \n        className={`fixed inset-0 ${isDarkMode ? 'bg-black/60' : 'bg-black/40'}`}\n        style={{ backdropFilter: 'blur(8px)', animation: 'fadeIn 0.2s ease-out' }} \n        onClick={() => { onClose(); setAcknowledged(false); }} \n      />\n      <div \n        className={`relative rounded-2xl shadow-2xl w-full max-w-sm p-6 ${\n          isDarkMode\n            ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95 border border-[#B19CD9]/30'\n            : 'bg-gradient-to-b from-white to-gray-50 border border-gray-200'\n        }`}\n        style={{ animation: 'slideUp 0.2s ease-out' }}\n      >\n        <h2 className={`text-xl font-semibold mb-4 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Disclaimer</h2>\n        <p className={`text-sm mb-4 leading-relaxed ${isDarkMode ? 'text-text-muted' : 'text-gray-600'}`}>\n          This app is for informational and tracking purposes only. Medication schedules shown are based on publicly available prescribing information and are not medical advice.\n        </p>\n        <p className={`text-sm mb-6 leading-relaxed ${isDarkMode ? 'text-text-muted' : 'text-gray-600'}`}>\n          By continuing, you confirm that the selected schedule was prescribed by your licensed healthcare provider. This app does not prescribe, recommend, or adjust medication doses. Always consult your healthcare provider before starting, stopping, or changing any medication.\n        </p>\n        <label className=\"flex items-start gap-3 mb-6 cursor-pointer\">\n          <div className=\"relative mt-0.5\">\n            <input\n              type=\"checkbox\"\n              checked={acknowledged}\n              onChange={(e) => setAcknowledged(e.target.checked)}\n              className={`peer w-5 h-5 appearance-none rounded border transition-all ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/50 bg-black/30 checked:bg-[#B19CD9] checked:border-[#B19CD9]'\n                  : 'border-gray-300 bg-white checked:bg-[#B19CD9] checked:border-[#B19CD9]'\n              }`}\n            />\n            <svg\n              className=\"absolute top-0.5 left-0.5 w-4 h-4 text-white pointer-events-none opacity-0 peer-checked:opacity-100\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n            </svg>\n          </div>\n          <span className=\"text-sm text-[#4ADEA8]\">I understand and agree to the above</span>\n        </label>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={() => { onClose(); setAcknowledged(false); }}\n            className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n              isDarkMode\n                ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n            }`}\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleContinue}\n            disabled={!acknowledged}\n            className={`flex-1 py-3 rounded-xl bg-gradient-to-r font-medium transition-all ${\n              acknowledged\n                ? 'from-[#B19CD9] to-[#9C7BD3] text-white hover:shadow-[0_0_20px_rgba(177,156,217,0.5)]'\n                : 'from-[#B19CD9]/50 to-[#9C7BD3]/50 text-white/50 cursor-not-allowed'\n            }`}\n          >\n            Continue\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DisclaimerModal;\n","import React from 'react';\n\ninterface DeleteConfirmModalProps {\n  isOpen: boolean;\n  medicationName: string;\n  onClose: () => void;\n  onConfirm: () => void;\n}\n\nconst DeleteConfirmModal: React.FC<DeleteConfirmModalProps> = ({ isOpen, medicationName, onClose, onConfirm }) => {\n  if (!isOpen) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-[10000] flex items-center justify-center p-4\"\n      style={{ animation: 'fadeIn 0.2s ease-out' }}\n    >\n      <div \n        className=\"fixed inset-0 bg-black/60\" \n        style={{ backdropFilter: 'blur(8px)', animation: 'fadeIn 0.2s ease-out' }} \n        onClick={onClose} \n      />\n      <div \n        className=\"relative bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95 rounded-2xl shadow-2xl border border-red-500/30 w-full max-w-sm p-6\"\n        style={{ animation: 'slideUp 0.2s ease-out' }}\n      >\n        <h2 className=\"text-xl font-semibold text-white mb-2\">Delete {medicationName}?</h2>\n        <p className=\"text-sm text-text-muted mb-6\">This will remove all protocols for this medication. This action cannot be undone.</p>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={onClose}\n            className=\"flex-1 py-3 rounded-xl border border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10 transition-all font-medium\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={onConfirm}\n            className=\"flex-1 py-3 rounded-xl bg-red-500/80 text-white font-medium hover:bg-red-500 transition-all\"\n          >\n            Delete\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DeleteConfirmModal;\n","import React from 'react';\n\ninterface OverdueDisclaimerModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n}\n\nconst OverdueDisclaimerModal: React.FC<OverdueDisclaimerModalProps> = ({ isOpen, onClose, onConfirm }) => {\n  if (!isOpen) return null;\n\n  return (\n    <div \n      className=\"fixed inset-0 z-[10000] flex items-center justify-center p-4\"\n      style={{ animation: 'fadeIn 0.2s ease-out' }}\n    >\n      <div \n        className=\"fixed inset-0 bg-black/60\" \n        style={{ backdropFilter: 'blur(8px)', animation: 'fadeIn 0.2s ease-out' }} \n        onClick={onClose} \n      />\n      <div \n        className=\"relative bg-gradient-to-b from-[#1a1625]/95 to-[#0d0a15]/95 rounded-2xl shadow-2xl border border-red-500/30 w-full max-w-sm p-6\"\n        style={{ animation: 'slideUp 0.2s ease-out' }}\n      >\n        <h3 className=\"text-lg font-bold text-white mb-3\">Disclaimer</h3>\n        <p className=\"text-sm text-gray-300 mb-4\">\n          By proceeding, you confirm that you have consulted your healthcare provider regarding any missed doses and understand this app does not provide medical advice.\n        </p>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={onClose}\n            className=\"flex-1 py-2 px-4 rounded-lg bg-gray-600 text-white font-semibold text-sm hover:bg-gray-500 transition-all\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={onConfirm}\n            className=\"flex-1 py-2 px-4 rounded-lg bg-gradient-to-r from-[#EF4444] to-[#F87171] text-white font-semibold text-sm hover:scale-[1.02] transition-all\"\n            style={{ boxShadow: '0 0 20px rgba(239,68,68,0.5)' }}\n          >\n            I Understand, Proceed\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default OverdueDisclaimerModal;\n","import React, { useState, useEffect } from 'react';\nimport { GLP1Protocol } from '../../../types';\nimport { MEDICATIONS, generateId } from '../../../constants/medications';\nimport DateWheelPickerModal from '../../../shared/components/DateWheelPickerModal';\nimport CalendarPickerModal from '../../../shared/components/CalendarPickerModal';\nimport { useTheme } from '../../../contexts/ThemeContext';\n\ninterface OfficialScheduleModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: (protocols: GLP1Protocol[]) => void;\n  useWheelForDate?: boolean;\n}\n\nconst OfficialScheduleModal: React.FC<OfficialScheduleModalProps> = ({ isOpen, onClose, onSave, useWheelForDate = true }) => {\n  const { isDarkMode } = useTheme();\n  const [selectedMedication, setSelectedMedication] = useState<string>('semaglutide');\n  const [startDate, setStartDate] = useState<string>(() => {\n    const today = new Date();\n    return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;\n  });\n  const [splitDosing, setSplitDosing] = useState(false);\n  const [showDatePicker, setShowDatePicker] = useState(false);\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      document.body.classList.add('modal-open');\n    } else if (isVisible && !isClosing) {\n      setIsClosing(true);\n      setTimeout(() => {\n        setIsVisible(false);\n        setIsClosing(false);\n        document.body.classList.remove('modal-open');\n      }, 200);\n    }\n  }, [isOpen]);\n\n  if (!isVisible) return null;\n\n  const handleCreate = () => {\n    const med = MEDICATIONS.find(m => m.id === selectedMedication);\n    if (!med?.titrationDoses || med.titrationDoses.length === 0) return;\n    \n    const titrationDoses = med.titrationDoses;\n    const daysPerDose = 28;\n    const freqValue = splitDosing ? 2 : 1;\n\n    const titrationProtocols: GLP1Protocol[] = titrationDoses.map((titrationDose, index) => {\n      const phaseStart = new Date(new Date(startDate).getTime() + index * daysPerDose * 24 * 60 * 60 * 1000);\n      const phaseEnd = new Date(new Date(startDate).getTime() + (index + 1) * daysPerDose * 24 * 60 * 60 * 1000 - 1);\n\n      return {\n        id: generateId(),\n        medication: med.name,\n        dose: splitDosing ? titrationDose / 2 : titrationDose,\n        frequencyPerWeek: freqValue,\n        startDate: phaseStart.toISOString().split('T')[0],\n        stopDate: phaseEnd.toISOString().split('T')[0],\n        halfLifeHours: med.halfLifeHours,\n        phase: 'titrate' as const,\n      };\n    });\n\n    onSave(titrationProtocols);\n    onClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center p-4\">\n      <div className={`fixed inset-0 bg-black/60 ${isClosing ? 'backdrop-fade-out' : 'backdrop-fade-in'}`} style={{ backdropFilter: 'blur(8px)' }} onClick={onClose} />\n      <div \n        className={`relative rounded-2xl shadow-2xl border border-[#B19CD9]/30 w-full max-w-sm p-6 ${\n          isDarkMode\n            ? 'bg-gradient-to-b from-[#1a1625]/70 to-[#0d0a15]/95' \n            : 'bg-white/95'\n        } ${isClosing ? 'modal-fade-out' : 'modal-fade-in'}`}\n      >\n        <h2 className={`text-xl font-semibold mb-6 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>Add Schedule</h2>\n        <div className=\"border-t border-[#B19CD9]/20 mb-3\"></div>\n        \n        <div className=\"space-y-4\">\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Medication</label>\n            <div className=\"grid grid-cols-1 gap-2\">\n              {MEDICATIONS.filter(m => m.titrationDoses && m.titrationDoses.length > 0 && ['semaglutide', 'tirzepatide', 'retatrutide', 'cagrilintide'].includes(m.id)).map(med => (\n                <button\n                  key={med.id}\n                  type=\"button\"\n                  onClick={() => setSelectedMedication(med.id)}\n                  className={`text-left px-3 py-2 rounded-lg transition-all text-sm ${\n                    selectedMedication === med.id\n                      ? 'bg-[#B19CD9]/30 border border-[#B19CD9]'\n                      : isDarkMode\n                        ? 'bg-black/20 border border-transparent hover:bg-[#B19CD9]/10'\n                        : 'bg-gray-100 border border-transparent hover:bg-gray-200'\n                  }`}\n                >\n                  <span className={`${isDarkMode ? 'text-text-primary' : 'text-gray-900'}`}>{med.name}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Split Dosing</label>\n            <div className=\"flex gap-2\">\n              <button\n                type=\"button\"\n                onClick={() => setSplitDosing(false)}\n                className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n                  !splitDosing\n                    ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white'\n                    : isDarkMode\n                      ? 'bg-black/20 text-[#B19CD9] border border-[#B19CD9]/30'\n                      : 'bg-gray-200 text-gray-700 border border-gray-300'\n                }`}\n              >\n                No\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setSplitDosing(true)}\n                className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n                  splitDosing\n                    ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white'\n                    : isDarkMode\n                      ? 'bg-black/20 text-[#B19CD9] border border-[#B19CD9]/30'\n                      : 'bg-gray-200 text-gray-700 border border-gray-300'\n                }`}\n              >\n                Yes\n              </button>\n            </div>\n            {splitDosing && (\n              <p className=\"text-xs text-[#4ADEA8] mt-1\">Dose will be split in half and taken every 3.5 days</p>\n            )}\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div>\n            <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-white' : 'text-gray-700'}`}>Start Date</label>\n            <button\n              type=\"button\"\n              onClick={() => setShowDatePicker(true)}\n              className={`w-full px-3 py-2 border rounded-lg text-sm text-left ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/30 bg-black/20 text-[#B19CD9]'\n                  : 'border-gray-300 bg-white text-gray-700'\n              }`}\n            >\n              {new Date(startDate).toLocaleDateString()}\n            </button>\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-4\"></div>\n\n          <div className=\"flex gap-3 pt-2\">\n            <button\n              onClick={onClose}\n              className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              Cancel\n            </button>\n            <button\n              onClick={handleCreate}\n              className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white font-medium hover:shadow-[0_0_20px_rgba(177,156,217,0.5)] transition-all\"\n            >\n              Create\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {showDatePicker && (\n        useWheelForDate ? (\n          <DateWheelPickerModal\n            isOpen={showDatePicker}\n            value={startDate}\n            onChange={(date) => {\n              setStartDate(date);\n              setShowDatePicker(false);\n            }}\n            onClose={() => setShowDatePicker(false)}\n          />\n        ) : (\n          <CalendarPickerModal\n            isOpen={showDatePicker}\n            value={startDate}\n            onChange={(date) => {\n              setStartDate(date);\n              setShowDatePicker(false);\n            }}\n            onClose={() => setShowDatePicker(false)}\n          />\n        )\n      )}\n    </div>\n  );\n};\n\nexport default OfficialScheduleModal;\n","import { useMemo } from 'react';\nimport { GLP1Protocol, GLP1Entry } from '../../../types';\nimport { timeService } from '../../../core/timeService';\nimport { normalizeMedName, MedicationKey, MEDICATION_KEYS } from '../../../shared/utils/medicationUtils';\n\nexport interface MedicationStats {\n  totalDoses: number;\n  currentDoses: never[];\n  totalCurrentDose: number;\n  nextDueDays: number;\n  nextDueHours: number;\n  nextDueMinutes: number;\n  nextDueSeconds: number;\n  nextDueDateStr: string;\n  currentLevel: number;\n  thisMonth: number;\n  plannedDoses: number;\n  lastDoseDateStr: string;\n  daysSinceLastDose: number;\n  actualDaysSinceLastDose: number;\n  intervalDays: number;\n  isScheduleStartDay: boolean;\n  isDueToday: boolean;\n  latestDoseDone: number | null;\n  isOverdue: boolean;\n  semaglutideIsOverdue: boolean;\n  tirzepatideIsOverdue: boolean;\n  retatrutideIsOverdue: boolean;\n  cagrilintideIsOverdue: boolean;\n  semaglutideEntryToday: boolean;\n  tirzepatideEntryToday: boolean;\n  retatrutideEntryToday: boolean;\n  cagrilintideEntryToday: boolean;\n  semaglutideDaysSinceLastDose: number;\n  tirzepatideDaysSinceLastDose: number;\n  retatrutideDaysSinceLastDose: number;\n  cagrilintideDaysSinceLastDose: number;\n}\n\nconst toLocalDateStr = (d: Date): string => {\n  const year = d.getFullYear();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\nconst parseYmd = (ymd: string) => {\n  const [y, m, d] = ymd.split('-').map(Number);\n  return new Date(y, m - 1, d).getTime();\n};\n\nconst computePerMedStats = (\n  medicationEntries: GLP1Entry[],\n  currentTimeDate: Date\n) => {\n  const stats: Record<MedicationKey, { isOverdue: boolean; daysSinceLastDose: number; entryToday: boolean }> = {\n    semaglutide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n    tirzepatide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n    retatrutide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n    cagrilintide: { isOverdue: false, daysSinceLastDose: 0, entryToday: false },\n  };\n\n  const todayStr = toLocalDateStr(currentTimeDate);\n  const todayLocal = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate());\n\n  for (const key of MEDICATION_KEYS) {\n    const medEntries = medicationEntries.filter(\n      e => normalizeMedName(e.medication) === key && e.isManual\n    );\n\n    if (medEntries.length === 0) {\n      stats[key] = { isOverdue: false, daysSinceLastDose: 0, entryToday: false };\n      continue;\n    }\n\n    const sorted = [...medEntries].sort(\n      (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()\n    );\n    const lastEntry = sorted[0];\n    if (!lastEntry) continue;\n\n    const [y, m, d] = lastEntry.date.split('-').map(Number);\n    const lastDateLocal = new Date(y, m - 1, d);\n    const daysDiff = Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n\n    stats[key] = {\n      isOverdue: daysDiff >= 8,\n      daysSinceLastDose: daysDiff,\n      entryToday: medEntries.some(e => e.date === todayStr),\n    };\n  }\n\n  return stats;\n};\n\nexport const useMedicationStats = (\n  medicationEntries: GLP1Entry[],\n  protocols: GLP1Protocol[],\n  currentTime: Date,\n  latestDoseDone: number | null,\n  medicationName?: string\n): MedicationStats => {\n  return useMemo(() => {\n    const currentTimeDate = new Date(currentTime);\n    const currentTimeMidnight = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate(), 0, 0, 0, 0);\n    const todayStr = toLocalDateStr(currentTimeDate);\n    \n    const filteredProtocols = medicationName\n      ? protocols?.filter(p => p.medication === medicationName && !p.isArchived)\n      : protocols?.filter(p => !p.isArchived);\n    \n    const filteredEntries = medicationName\n      ? medicationEntries.filter(e => e.medication === medicationName)\n      : medicationEntries;\n    \n    const activeProtocol = filteredProtocols?.find(p => {\n      const start = p.startDate;\n      const end = p.stopDate || '2099-12-31';\n      return todayStr >= start && todayStr <= end;\n    });\n    \n    let intervalDays = 7;\n    if (activeProtocol) {\n      intervalDays = Math.round(7 / activeProtocol.frequencyPerWeek);\n    }\n    \n    const sortedEntries = [...filteredEntries].sort((a, b) => \n      new Date(b.date).getTime() - new Date(a.date).getTime()\n    );\n    \n    let lastScheduledDate: Date | null = null;\n    let nextDueDays = 0;\n    let nextDueHours = 0;\n    let nextDueMinutes = 0;\n    let nextDueSeconds = 0;\n    let daysSinceLastDose = 0;\n    let nextDueDateStr = 'N/A';\n    let nextDoseDate: Date | null = null;\n    \n    const protocolStartDate = activeProtocol?.startDate || '';\n    const todayTimestamp = currentTimeDate.getTime();\n    \n    if (activeProtocol && protocolStartDate) {\n      const startTimestamp = parseYmd(protocolStartDate);\n      const todayTimestampMidnight = parseYmd(todayStr);\n      const intervalMs = intervalDays * 24 * 60 * 60 * 1000;\n      \n      const daysSinceStart = Math.floor((todayTimestampMidnight - startTimestamp) / (24 * 60 * 60 * 1000));\n      \n      const fullIntervalsPassed = Math.floor(daysSinceStart / intervalDays);\n      const dayWithinInterval = daysSinceStart % intervalDays;\n      \n      const nextDoseTimestamp = startTimestamp + (fullIntervalsPassed + (dayWithinInterval === 0 ? 0 : 1)) * intervalMs;\n      const lastDoseTimestamp = nextDoseTimestamp - intervalMs;\n      \n      lastScheduledDate = new Date(lastDoseTimestamp);\n      nextDoseDate = new Date(nextDoseTimestamp);\n      \n      daysSinceLastDose = (currentTimeDate.getTime() - lastDoseTimestamp) / (24 * 60 * 60 * 1000);\n      \n      const diffMs = nextDoseTimestamp - todayTimestamp;\n      nextDueDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n      nextDueHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n      nextDueMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n      nextDueSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);\n      \n      nextDueDateStr = nextDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n    }\n    \n    const lastDoseDate = lastScheduledDate;\n    const lastDoseDateStr = lastDoseDate \n      ? lastDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })\n      : 'N/A';\n      \n    if (!activeProtocol && lastDoseDate) {\n      daysSinceLastDose = (currentTimeDate.getTime() - lastDoseDate.getTime()) / (1000 * 60 * 60 * 24);\n      \n      nextDoseDate = new Date(lastDoseDate.getTime() + (intervalDays * 24 * 60 * 60 * 1000));\n      nextDueDateStr = nextDoseDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n      \n      const diffMs = nextDoseDate.getTime() - currentTimeDate.getTime();\n      nextDueDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n      nextDueHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n      nextDueMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n      nextDueSeconds = Math.floor((diffMs % (1000 * 60)) / 1000);\n      \n      if (diffMs < 0 && nextDueDays === 0) {\n        nextDueHours = Math.ceil(diffMs / (1000 * 60 * 60));\n        if (nextDueHours < 0) {\n          nextDueDays = -1;\n          nextDueHours = 24 + nextDueHours;\n        }\n      }\n    }\n    \n    const totalDoses = filteredEntries.length;\n    const totalCurrentDose = filteredEntries.length > 0 ? filteredEntries[0].dose : 0;\n    \n    const thisMonthDoses = filteredEntries.filter(entry => {\n      const entryDate = new Date(entry.date);\n      return entryDate.getMonth() === currentTimeDate.getMonth() && \n             entryDate.getFullYear() === currentTimeDate.getFullYear();\n    }).length;\n    \n    const upcomingDoses = (() => {\n      if (!filteredProtocols || filteredProtocols.length === 0) return 0;\n      \n      const nextMonth = new Date(currentTimeDate);\n      nextMonth.setMonth(nextMonth.getMonth() + 1);\n      \n      let count = 0;\n      filteredProtocols!.forEach(protocol => {\n        const start = new Date(protocol.startDate);\n        const end = protocol.stopDate ? new Date(protocol.stopDate) : nextMonth;\n        const interval = 7 / protocol.frequencyPerWeek;\n        \n        let d = new Date(start);\n        while (d <= end && d <= nextMonth) {\n          if (d > currentTimeDate) count++;\n          d = new Date(d.getTime() + interval * 24 * 60 * 60 * 1000);\n        }\n      });\n      return count;\n    })();\n    \n    const isScheduleStartDay = !!(activeProtocol && activeProtocol.startDate === todayStr);\n    \n    const nextDoseDateAtMidnight = nextDoseDate ? toLocalDateStr(nextDoseDate) : null;\n    const isDueToday = nextDoseDateAtMidnight === todayStr;\n    \n    const perMedStats = computePerMedStats(medicationEntries, currentTimeDate);\n    \n    return { \n      totalDoses, \n      currentDoses: [], \n      totalCurrentDose, \n      nextDueDays, \n      nextDueHours, \n      nextDueMinutes, \n      nextDueSeconds, \n      nextDueDateStr, \n      currentLevel: 0, \n      thisMonth: thisMonthDoses, \n      plannedDoses: upcomingDoses, \n      lastDoseDateStr, \n      daysSinceLastDose, \n      intervalDays,\n      isScheduleStartDay,\n      isDueToday,\n      latestDoseDone,\n      isOverdue: (() => {\n        if (filteredEntries.length === 0) return false;\n        const sortedEntries = [...filteredEntries].sort((a, b) => \n          new Date(b.date).getTime() - new Date(a.date).getTime()\n        );\n        const lastEntry = sortedEntries[0];\n        if (!lastEntry) return false;\n        const lastDate = new Date(lastEntry.date);\n        const lastDateLocal = new Date(lastDate.getFullYear(), lastDate.getMonth(), lastDate.getDate());\n        const todayLocal = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate());\n        const daysDiff = Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n        return daysDiff >= 8;\n      })(),\n      actualDaysSinceLastDose: (() => {\n        if (filteredEntries.length === 0) return 0;\n        const sortedEntries = [...filteredEntries].sort((a, b) => \n          new Date(b.date).getTime() - new Date(a.date).getTime()\n        );\n        const lastEntry = sortedEntries[0];\n        if (!lastEntry) return 0;\n        const lastDate = new Date(lastEntry.date);\n        const lastDateLocal = new Date(lastDate.getFullYear(), lastDate.getMonth(), lastDate.getDate());\n        const todayLocal = new Date(currentTimeDate.getFullYear(), currentTimeDate.getMonth(), currentTimeDate.getDate());\n        return Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n      })(),\n      semaglutideIsOverdue: perMedStats.semaglutide.isOverdue,\n      tirzepatideIsOverdue: perMedStats.tirzepatide.isOverdue,\n      retatrutideIsOverdue: perMedStats.retatrutide.isOverdue,\n      cagrilintideIsOverdue: perMedStats.cagrilintide.isOverdue,\n      semaglutideEntryToday: perMedStats.semaglutide.entryToday,\n      tirzepatideEntryToday: perMedStats.tirzepatide.entryToday,\n      retatrutideEntryToday: perMedStats.retatrutide.entryToday,\n      cagrilintideEntryToday: perMedStats.cagrilintide.entryToday,\n      semaglutideDaysSinceLastDose: perMedStats.semaglutide.daysSinceLastDose,\n      tirzepatideDaysSinceLastDose: perMedStats.tirzepatide.daysSinceLastDose,\n      retatrutideDaysSinceLastDose: perMedStats.retatrutide.daysSinceLastDose,\n      cagrilintideDaysSinceLastDose: perMedStats.cagrilintide.daysSinceLastDose,\n    };\n  }, [medicationEntries, protocols, currentTime, latestDoseDone, medicationName]);\n};\n\nexport const isMedicationOverdue = (\n  medicationEntries: GLP1Entry[],\n  medicationName: string,\n  currentTime: Date\n): boolean => {\n  const normalizedName = normalizeMedName(medicationName);\n  if (!normalizedName) return false;\n  \n  const filteredEntries = medicationEntries.filter(e => normalizeMedName(e.medication) === normalizedName && e.isManual);\n  if (filteredEntries.length === 0) return false;\n  \n  const sortedEntries = [...filteredEntries].sort((a, b) => \n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n  const lastEntry = sortedEntries[0];\n  if (!lastEntry) return false;\n  \n  const [y, m, d] = lastEntry.date.split('-').map(Number);\n  const lastDateLocal = new Date(y, m - 1, d);\n  const todayLocal = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate());\n  const daysDiff = Math.floor((todayLocal.getTime() - lastDateLocal.getTime()) / (24 * 60 * 60 * 1000));\n  return daysDiff >= 8;\n};\n\nexport const useActiveProtocol = (protocols: GLP1Protocol[]): GLP1Protocol | undefined => {\n  return useMemo(() => {\n    const todayStr = timeService.todayString();\n    return protocols?.find(p => {\n      if (p.isArchived) return false;\n      const start = p.startDate;\n      const end = p.stopDate || '2099-12-31';\n      return todayStr >= start && todayStr <= end;\n    });\n  }, [protocols]);\n};\n","import React, { useState, useMemo, useEffect } from 'react';\r\nimport MedicationChart from './components/MedicationChart';\r\nimport MedicationModal from './components/MedicationModal';\r\nimport LogDoseModal from './components/LogDoseModal';\r\nimport PeriodSelector from '../../shared/components/PeriodSelector';\r\nimport ProtocolModal from './components/ProtocolModal';\r\nimport Button from '../../shared/components/Button';\r\nimport MedicationProgressBar from './components/MedicationProgressBar';\r\nimport MedicationProgressBarContainer from './components/MedicationProgressBarContainer';\r\nimport ProtocolList from './components/ProtocolList';\r\nimport DisclaimerModal from './components/DisclaimerModal';\r\nimport DeleteConfirmModal from './components/DeleteConfirmModal';\r\nimport OverdueDisclaimerModal from './components/OverdueDisclaimerModal';\r\nimport OfficialScheduleModal from './components/OfficialScheduleModal';\r\nimport { GLP1Entry, GLP1Protocol } from '../../types';\r\nimport { ChartPeriod, useTime } from '../../shared/hooks';\r\nimport { useThemeStyles } from '../../contexts/ThemeContext';\r\nimport { addMedicationGeneratedEntry, addMedicationManualEntry, clearMedicationEntries, deleteMedicationProtocol, saveMedicationProtocols, getMedicationManualEntries } from '../../shared/utils/database';\r\nimport { MEDICATIONS, generateId } from '../../constants/medications';\r\nimport { generateDosesFromProtocols, saveProtocol, deleteProtocol, archiveProtocol, getActiveProtocols } from '../../services/MedicationService';\r\nimport { timeService } from '../../core/timeService';\r\nimport { useMedicationStats, useActiveProtocol, isMedicationOverdue } from './hooks/useMedicationStats';\r\n\r\ninterface MedicationTabProps {\n  medicationEntries: GLP1Entry[];\n  onAddMedication: (dose: number, medication: string, date: string) => void;\n  onRefreshMedications: () => void;\n  onLogDose: () => void;\n  chartPeriod: ChartPeriod;\n  onChartPeriodChange: (period: ChartPeriod) => void;\n  useWheelForNumbers?: boolean;\n  useWheelForDate?: boolean;\n}\n\nconst MedicationTab: React.FC<MedicationTabProps> = ({ medicationEntries, onAddMedication, onRefreshMedications, onLogDose, chartPeriod, onChartPeriodChange, useWheelForNumbers = true, useWheelForDate = true }) => {\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [showLogDoseModal, setShowLogDoseModal] = useState(false);\r\n  const [isLogging, setIsLogging] = useState(false);\r\n  const [activeProtocolForModal, setActiveProtocolForModal] = useState<GLP1Protocol | null>(null);\r\n  const [protocols, setProtocols] = useState<GLP1Protocol[]>(() => getActiveProtocols());\r\n  const [editingProtocol, setEditingProtocol] = useState<GLP1Protocol | null>(null);\r\n  const [isProtocolModalOpen, setIsProtocolModalOpen] = useState(false);\r\n  const [protocolModalMode, setProtocolModalMode] = useState<'add' | 'edit'>('add');\r\n  const [showOfficialScheduleModal, setShowOfficialScheduleModal] = useState(false);\r\n  const [showDisclaimer, setShowDisclaimer] = useState(false);\r\n  const [deleteConfirmMed, setDeleteConfirmMed] = useState<string | null>(null);\r\n  const [collapsedMedications, setCollapsedMedications] = useState<Set<string>>(() => {\n    const saved = localStorage.getItem('glpal_collapsed_medications');\n    return saved ? new Set(JSON.parse(saved)) : new Set();\n  });\n\n  useEffect(() => {\n    localStorage.setItem('glpal_collapsed_medications', JSON.stringify(Array.from(collapsedMedications)));\n  }, [collapsedMedications]);\r\n\r\n  const [showProgressDebug, setShowProgressDebug] = useState(false);\r\n  const [showOverdueDisclaimer, setShowOverdueDisclaimer] = useState(false);\r\n  const [loggingMedicationName, setLoggingMedicationName] = useState<string>('');\r\n  const [latestDoseDone, setLatestDoseDone] = useState<number | null>(() => {\r\n    const saved = localStorage.getItem('latestDoseDone');\r\n    return saved ? parseInt(saved, 10) : null;\r\n  });\r\n\r\n  const nowTimestamp = useTime(100);\r\n  const now = new Date(nowTimestamp);\r\n  const activeProtocol = useActiveProtocol(protocols);\r\n  const stats = useMedicationStats(medicationEntries, protocols, now, latestDoseDone);\r\n\r\n  const uniqueMedications = useMemo(() => {\r\n    const medSet = new Set<string>();\r\n    protocols.forEach(p => {\r\n      if (!p.isArchived) {\r\n        medSet.add(p.medication);\r\n      }\r\n    });\r\n    return Array.from(medSet);\r\n  }, [protocols]);\r\n\r\n  const { bigCard, bigCardText, smallCard, text } = useThemeStyles();\r\n\r\n  const generatedEntries = useMemo(\r\n    () => medicationEntries.filter(e => !e.isManual),\r\n    [medicationEntries]\r\n  );\r\n\r\n  useEffect(() => {\n    const saved = localStorage.getItem('latestDoseDone');\n    if (saved) {\n      setLatestDoseDone(parseInt(saved, 10));\n    }\n  }, []);\n\r\n  const handleGenerateDoses = (protocolList: GLP1Protocol[]) => {\r\n    clearMedicationEntries();\r\n    const generatedDoses = generateDosesFromProtocols(protocolList, []);\r\n    generatedDoses.forEach(entry => addMedicationGeneratedEntry(entry));\r\n    \r\n    const now = new Date();\r\n    now.setHours(0, 0, 0, 0);\r\n    \r\n    protocolList.forEach(protocol => {\r\n      if (protocol.isArchived) return;\r\n      \r\n      const start = new Date(protocol.startDate);\r\n      const stop = protocol.stopDate ? new Date(protocol.stopDate) : now;\r\n      const intervalDays = 7 / protocol.frequencyPerWeek;\r\n      \r\n      let d = new Date(start);\n      while (d < stop && d <= now) {\n        const dateStr = d.toISOString().split('T')[0];\r\n        \r\n        const existingManual = getMedicationManualEntries();\r\n        const alreadyLogged = existingManual.some(e => e.date === dateStr && e.medication === protocol.medication);\r\n        \r\n        if (!alreadyLogged) {\r\n          const manualEntry: GLP1Entry = {\r\n            date: dateStr,\r\n            medication: protocol.medication,\r\n            dose: protocol.dose,\r\n            halfLifeHours: protocol.halfLifeHours,\r\n            isManual: true\r\n          };\r\n          addMedicationManualEntry(manualEntry);\r\n        }\r\n        \r\n        d = new Date(d.getTime() + intervalDays * 24 * 60 * 60 * 1000);\r\n      }\r\n    });\r\n  };\r\n\r\n  const toggleMedication = (medicationName: string) => {\r\n    setCollapsedMedications(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(medicationName)) {\r\n        newSet.delete(medicationName);\r\n      } else {\r\n        newSet.add(medicationName);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  const handleDeleteMedication = (medicationName: string) => {\r\n    let updatedProtocols = [...protocols];\r\n    protocols.forEach(p => {\r\n      const med = MEDICATIONS.find(m => m.id === p.medication);\r\n      if ((med?.name || p.medication) === medicationName) {\r\n        deleteMedicationProtocol(p.id);\r\n        updatedProtocols = updatedProtocols.filter(proc => proc.id !== p.id);\r\n      }\r\n    });\r\n    saveMedicationProtocols(updatedProtocols);\r\n    setProtocols(updatedProtocols);\r\n    handleGenerateDoses(updatedProtocols);\r\n    onRefreshMedications();\r\n    setCollapsedMedications(prev => {\r\n      const newSet = new Set(prev);\r\n      newSet.delete(medicationName);\r\n      return newSet;\r\n    });\r\n    setDeleteConfirmMed(null);\r\n  };\r\n\r\n  const handleSaveProtocol = (protocol: GLP1Protocol) => {\r\n    const updatedProtocols = saveProtocol(protocol, protocols);\r\n    setProtocols(updatedProtocols);\r\n    handleGenerateDoses(updatedProtocols);\r\n    onRefreshMedications();\r\n  };\r\n\r\n  const handleEditProtocol = (protocol: GLP1Protocol) => {\r\n    setEditingProtocol(protocol);\r\n    setProtocolModalMode('edit');\r\n    setIsProtocolModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteProtocol = (id: string) => {\r\n    const updatedList = deleteProtocol(id, protocols);\r\n    setProtocols(updatedList);\r\n    setEditingProtocol(null);\r\n    onRefreshMedications();\r\n  };\r\n\r\n  const handleArchiveProtocol = (protocol: GLP1Protocol) => {\r\n    const updatedList = archiveProtocol(protocol, protocols);\r\n    setProtocols(updatedList);\r\n    setEditingProtocol(null);\r\n    onRefreshMedications();\r\n  };\r\n\r\n  const handleOfficialScheduleSave = (newProtocols: GLP1Protocol[]) => {\r\n    const updatedProtocols = [...protocols, ...newProtocols];\r\n    saveMedicationProtocols(updatedProtocols);\r\n    setProtocols(updatedProtocols);\r\n    handleGenerateDoses(updatedProtocols);\r\n    onRefreshMedications();\r\n    setShowOfficialScheduleModal(false);\r\n  };\r\n\r\n  const handleRegenerate = () => {\r\n    if (protocols && protocols.length > 0) {\r\n      handleGenerateDoses(protocols);\r\n    }\r\n  };\r\n\r\n  const getActiveProtocolForMedication = (medicationName: string) => {\r\n    return protocols.find(p => {\r\n      if (p.isArchived || p.medication !== medicationName) return false;\r\n      const start = p.startDate;\r\n      const end = p.stopDate || '2099-12-31';\r\n      const todayStr = timeService.todayString();\r\n      return todayStr >= start && todayStr <= end;\r\n    });\r\n  };\r\n\r\n  const handleLogDoseNow = (medicationName?: string) => {\r\n    const targetMed = medicationName || activeProtocol?.medication;\r\n    const targetProtocol = targetMed ? getActiveProtocolForMedication(targetMed) : activeProtocol;\r\n    \r\n    // Check overdue per medication\r\n    const statsOverdue = targetMed ? isMedicationOverdue(medicationEntries, targetMed, now) : false;\r\n    \r\n    if (statsOverdue) {\r\n      setLoggingMedicationName(targetMed || '');\r\n      setShowOverdueDisclaimer(true);\r\n      return;\r\n    }\r\n    \r\n    const today = timeService.nowDate();\r\n    const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;\r\n    \r\n    if (targetProtocol) {\r\n      setIsLogging(true);\r\n      setActiveProtocolForModal(targetProtocol);\r\n      setShowLogDoseModal(true);\r\n    } else {\r\n      setIsModalOpen(true);\r\n    }\r\n  };\r\n  \r\n  const handleConfirmOverdueDose = () => {\r\n    setShowOverdueDisclaimer(false);\r\n    const today = timeService.nowDate();\r\n    const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;\r\n    \r\n    const targetMed = loggingMedicationName || activeProtocol?.medication;\r\n    const targetProtocol = targetMed ? getActiveProtocolForMedication(targetMed) : activeProtocol;\r\n    if (targetProtocol) {\r\n      setIsLogging(true);\r\n      setActiveProtocolForModal(targetProtocol);\r\n      setShowLogDoseModal(true);\r\n    } else {\r\n      setIsModalOpen(true);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const todayStr = timeService.todayString();\r\n    const savedDate = localStorage.getItem('lastLoggedDate');\r\n    const savedProtocolId = localStorage.getItem('lastLoggedProtocolId');\r\n    \r\n    const isNewDay = savedDate !== todayStr;\r\n    const isNewProtocol = savedProtocolId !== (activeProtocol?.id || '');\r\n    \r\n    if (isNewDay) {\r\n      localStorage.setItem('lastLoggedDate', todayStr);\r\n    }\r\n    if (isNewProtocol && activeProtocol) {\r\n      localStorage.setItem('lastLoggedProtocolId', activeProtocol.id);\r\n    }\r\n  }, [now, activeProtocol?.id, medicationEntries]);\r\n\r\n  const handleDisclaimerAcknowledged = () => {\r\n    setShowDisclaimer(false);\r\n    setShowOfficialScheduleModal(true);\r\n  };\r\n\r\n  const handleOpenOfficialSchedule = () => {\r\n    const acknowledged = localStorage.getItem('glpal_disclaimer_acknowledged');\r\n    if (acknowledged === 'true') {\r\n      setShowOfficialScheduleModal(true);\r\n    } else {\r\n      setShowDisclaimer(true);\r\n    }\r\n  };\r\n\r\n  const handleLogDoseSave = () => {\r\n    const now = timeService.nowDate();\r\n    setLatestDoseDone(now.getTime());\r\n    localStorage.setItem('latestDoseDone', now.getTime().toString());\r\n    onRefreshMedications();\r\n    onLogDose();\r\n    setIsLogging(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      <div className={bigCard}>\r\n        <h1 className={bigCardText.title} style={{ textShadow: '0 0 15px var(--accent-purple-light-shadow)' }}>Doses</h1>\r\n        <div className=\"border-t border-[#B19CD9]/20 mb-3\"></div>\r\n        \r\n        <div className=\"space-y-3 mb-6\">\r\n          <div className=\"grid grid-cols-3 gap-2 sm:gap-3 overflow-visible\">\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Total Doses</p>\r\n              <p className={text.value}>{stats.totalDoses}</p>\r\n            </div>\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Next Due</p>\r\n              <p className={text.totalLossValue} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end' }}>\r\n                <span style={{ display: 'inline-block', whiteSpace: 'nowrap' }}>{stats.nextDueDays > 0 ? `${stats.nextDueDays} Day${stats.nextDueDays > 1 ? 's' : ''}` : 'Today'}</span>\r\n                <span className={text.percentage}>{stats.nextDueDateStr}</span>\r\n              </p>\r\n            </div>\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Current Dose</p>\r\n              <p className={text.value}>{stats.totalCurrentDose.toFixed(2)}mg</p>\r\n            </div>\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Current Level</p>\r\n              <p className={text.value}>{stats.currentLevel.toFixed(2)}mg</p>\r\n            </div>\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Planned Doses</p>\r\n              <p className={text.value}>{stats.plannedDoses}</p>\r\n            </div>\r\n            <div className={smallCard}>\r\n              <p className={text.label}>Logged Doses</p>\r\n              <p className={text.value}>{stats.thisMonth}</p>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\r\n          \r\n          {uniqueMedications.map((medicationName, index) => (\r\n            <div key={medicationName}>\r\n              {index > 0 && <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>}\r\n              <MedicationProgressBarContainer\r\n                medicationEntries={medicationEntries}\r\n                protocols={protocols}\r\n                currentTime={now}\r\n                latestDoseDone={latestDoseDone}\r\n                medicationName={medicationName}\r\n                onLogDose={() => handleLogDoseNow(medicationName)}\r\n                isLogging={isLogging}\r\n                allMedications={uniqueMedications}\r\n              />\r\n            </div>\r\n          ))}\r\n          \r\n          {process.env.NODE_ENV === 'development' && (\r\n            <button\r\n              onClick={() => setShowProgressDebug(!showProgressDebug)}\r\n              className=\"text-xs text-[#B19CD9]/50 hover:text-[#B19CD9] underline mb-2\"\r\n            >\r\n              {showProgressDebug ? ' Hide' : ' Show'} Progress Bar Debug\r\n            </button>\r\n          )}\r\n          \r\n          {process.env.NODE_ENV === 'development' && showProgressDebug && (\r\n            <ProgressDebugPanel \r\n              stats={stats} \r\n              now={now} \r\n              activeProtocol={activeProtocol} \r\n              medicationEntries={medicationEntries}\r\n              doseLoggedToday={medicationEntries.some(e => e.date === timeService.todayString() && e.isManual)}\r\n              protocols={protocols}\r\n              uniqueMedications={uniqueMedications}\r\n            />\r\n          )}\r\n          \r\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\r\n\r\n          <div>\r\n            <PeriodSelector value={chartPeriod} onChange={onChartPeriodChange} />\r\n            <div className=\"h-64 sm:h-80\">\r\n              <MedicationChart \r\n                data={generatedEntries} \r\n                period={chartPeriod} \r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\r\n\r\n        <Button onClick={() => setIsModalOpen(true)} fullWidth>\r\n          + Log Dose Manually\r\n        </Button>\r\n      </div>\r\n\r\n      <div className={bigCard}>\r\n        <h1 className={bigCardText.title} style={{ textShadow: '0 0 15px var(--accent-purple-light-shadow)' }}>Dosing Plans</h1>\r\n        <div className=\"border-t border-[#B19CD9]/20 mb-3\"></div>\r\n        \r\n        <ProtocolList\r\n          protocols={protocols}\r\n          collapsedMedications={collapsedMedications}\r\n          onToggleMedication={toggleMedication}\r\n          onEditProtocol={handleEditProtocol}\r\n          onDeleteClick={setDeleteConfirmMed}\r\n        />\r\n\r\n        <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\r\n\r\n        <div className=\"flex gap-2\">\r\n          <Button \r\n            onClick={() => {\r\n              setProtocolModalMode('add');\r\n              setEditingProtocol(null);\r\n              setIsProtocolModalOpen(true);\r\n            }} \r\n            fullWidth\r\n            variant=\"accent\"\r\n          >\r\n            + Custom Plan\r\n          </Button>\r\n\r\n          <Button \r\n            onClick={handleOpenOfficialSchedule}\r\n            fullWidth\r\n            variant=\"accent\"\r\n          >\r\n            + Schedule\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <ProtocolModal\n        isOpen={isProtocolModalOpen}\n        onClose={() => setIsProtocolModalOpen(false)}\n        onSave={handleSaveProtocol}\n        onArchive={handleArchiveProtocol}\n        onDelete={handleDeleteProtocol}\n        protocol={editingProtocol}\n        mode={protocolModalMode}\n        existingProtocols={protocols}\n        useWheelForNumbers={useWheelForNumbers}\n        useWheelForDate={useWheelForDate}\n      />\n\r\n      <OfficialScheduleModal\n        isOpen={showOfficialScheduleModal}\n        onClose={() => setShowOfficialScheduleModal(false)}\n        onSave={handleOfficialScheduleSave}\n        useWheelForDate={useWheelForDate}\n      />\n\n      <MedicationModal\n        isOpen={isModalOpen}\n        onClose={() => setIsModalOpen(false)}\n        onAddMedication={onAddMedication}\n        useWheelForDate={useWheelForDate}\n      />\n\r\n      <LogDoseModal\r\n        isOpen={showLogDoseModal}\r\n        onClose={() => {\r\n          setShowLogDoseModal(false);\r\n          setIsLogging(false);\r\n        }}\r\n        onSave={handleLogDoseSave}\r\n        protocol={activeProtocolForModal || activeProtocol || null}\r\n        allMedications={uniqueMedications}\r\n      />\r\n\r\n      <OverdueDisclaimerModal\r\n        isOpen={showOverdueDisclaimer}\r\n        onClose={() => setShowOverdueDisclaimer(false)}\r\n        onConfirm={handleConfirmOverdueDose}\r\n      />\r\n\r\n      <DeleteConfirmModal\r\n        isOpen={!!deleteConfirmMed}\r\n        medicationName={deleteConfirmMed || ''}\r\n        onClose={() => setDeleteConfirmMed(null)}\r\n        onConfirm={() => deleteConfirmMed && handleDeleteMedication(deleteConfirmMed)}\r\n      />\r\n\r\n      <DisclaimerModal\r\n        isOpen={showDisclaimer}\r\n        onClose={() => setShowDisclaimer(false)}\r\n        onAcknowledged={handleDisclaimerAcknowledged}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface ProgressDebugPanelProps {\r\n  stats: ReturnType<typeof useMedicationStats>;\r\n  now: Date;\r\n  activeProtocol: GLP1Protocol | undefined;\r\n  medicationEntries: GLP1Entry[];\r\n  doseLoggedToday: boolean;\r\n  protocols: GLP1Protocol[];\r\n  uniqueMedications: string[];\r\n}\r\n\r\nconst ProgressDebugPanel: React.FC<ProgressDebugPanelProps> = ({ stats, now, activeProtocol, medicationEntries, doseLoggedToday, protocols, uniqueMedications }) => {\r\n  const todayStr = timeService.todayString();\r\n\r\n  const getMedStats = (medName: string) => {\r\n    const filteredEntries = medicationEntries.filter(e => e.medication === medName);\r\n    const filteredProtocols = protocols.filter(p => p.medication === medName && !p.isArchived);\r\n    return { filteredEntries, filteredProtocols };\r\n  };\r\n\r\n  return (\r\n    <div className=\"mb-4 p-3 rounded-lg bg-black/40 border border-red-500/30 text-xs font-mono max-h-96 overflow-y-auto\">\r\n      <div className=\"text-red-400 font-bold mb-2\">Progress Bar Debug Panel</div>\r\n      \r\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1\">\r\n        <span className=\"text-gray-400\">now:</span>\r\n        <span className=\"text-white\">{now.toString()}</span>\r\n        \r\n        <span className=\"text-gray-400\">Current Time:</span>\r\n        <span className=\"text-white\">{new Date(now).toLocaleTimeString()}</span>\r\n        \r\n        <span className=\"text-gray-400\">todayStr:</span>\r\n        <span className=\"text-yellow-400\">{(() => {\r\n          const ct = new Date(now);\r\n          const y = ct.getFullYear();\r\n          const m = String(ct.getMonth() + 1).padStart(2, '0');\r\n          const d = String(ct.getDate()).padStart(2, '0');\r\n          return `${y}-${m}-${d}`;\r\n        })()}</span>\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">All Medications: {uniqueMedications.length}</div>\r\n      <div className=\"grid grid-cols-1 gap-y-1 mb-2\">\r\n        {uniqueMedications.map(med => {\r\n          const { filteredEntries, filteredProtocols } = getMedStats(med);\r\n          const medHasEntryToday = filteredEntries.some(e => e.date === todayStr && e.isManual);\r\n          const medHasProtocol = filteredProtocols.length > 0;\r\n          const activeForMed = filteredProtocols.find(p => {\r\n            const start = p.startDate;\r\n            const end = p.stopDate || '2099-12-31';\r\n            return todayStr >= start && todayStr <= end;\r\n          });\r\n          return (\r\n            <div key={med} className=\"grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs\">\r\n              <span className=\"text-cyan-400\">{med}:</span>\r\n              <span className={medHasEntryToday ? 'text-green-400' : 'text-gray-400'}>\r\n                {medHasEntryToday ? 'LOGGED' : 'not logged'} | \r\n                {medHasProtocol ? ` ${filteredProtocols.length} prot` : ' no prot'} |\r\n                {activeForMed ? ` active: ${activeForMed.dose}mg` : ' no active'}\r\n              </span>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Active Protocol (Global):</div>\r\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1\">\r\n        <span className=\"text-gray-400\">activeProtocol:</span>\r\n        <span className=\"text-white\">{activeProtocol ? 'EXISTS' : 'NULL'}</span>\r\n        \r\n        {activeProtocol && (\r\n          <>\r\n            <span className=\"text-gray-400\">protocol.id:</span>\r\n            <span className=\"text-cyan-400\">{activeProtocol.id}</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.medication:</span>\r\n            <span className=\"text-white\">{activeProtocol.medication}</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.startDate:</span>\r\n            <span className=\"text-yellow-400\">{activeProtocol.startDate}</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.stopDate:</span>\r\n            <span className=\"text-yellow-400\">{activeProtocol.stopDate || 'none'}</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.frequencyPerWeek:</span>\r\n            <span className=\"text-white\">{activeProtocol.frequencyPerWeek}</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.dose:</span>\r\n            <span className=\"text-white\">{activeProtocol.dose}mg</span>\r\n            \r\n            <span className=\"text-gray-400\">protocol.halfLifeHours:</span>\r\n            <span className=\"text-white\">{activeProtocol.halfLifeHours}h</span>\r\n          </>\r\n        )}\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Stats Object (First Medication):</div>\r\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1\">\r\n        <span className=\"text-gray-400\">totalDoses:</span>\r\n        <span className=\"text-white\">{stats.totalDoses}</span>\r\n        \r\n        <span className=\"text-gray-400\">totalCurrentDose:</span>\r\n        <span className=\"text-white\">{stats.totalCurrentDose}mg</span>\r\n        \r\n        <span className=\"text-gray-400\">thisMonth:</span>\r\n        <span className=\"text-white\">{stats.thisMonth}</span>\r\n        \r\n        <span className=\"text-gray-400\">plannedDoses:</span>\r\n        <span className=\"text-white\">{stats.plannedDoses}</span>\r\n        \r\n        <span className=\"text-gray-400\">intervalDays:</span>\r\n        <span className=\"text-white\">{stats.intervalDays}</span>\r\n        \r\n        <span className=\"text-gray-400\">daysSinceLastDose:</span>\r\n        <span className=\"text-white\">{stats.daysSinceLastDose?.toFixed(2) || 'N/A'}</span>\r\n        \r\n        <span className=\"text-gray-400\">lastDoseDateStr:</span>\r\n        <span className=\"text-yellow-400\">{stats.lastDoseDateStr}</span>\r\n        \r\n        <span className=\"text-gray-400\">nextDueDateStr:</span>\r\n        <span className=\"text-yellow-400\">{stats.nextDueDateStr}</span>\r\n        \r\n        <span className=\"text-gray-400\">latestDoseDone:</span>\r\n        <span className=\"text-yellow-400\">{stats.latestDoseDone ? stats.latestDoseDone + ' (' + new Date(stats.latestDoseDone).toLocaleDateString() + ')' : 'NULL'}</span>\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Time Until Next Dose:</div>\r\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1\">\r\n        <span className=\"text-gray-400\">nextDueDays:</span>\r\n        <span className=\"text-white\">{stats.nextDueDays}</span>\r\n        \r\n        <span className=\"text-gray-400\">nextDueHours:</span>\r\n        <span className=\"text-white\">{stats.nextDueHours}</span>\r\n        \r\n        <span className=\"text-gray-400\">nextDueMinutes:</span>\r\n        <span className=\"text-white\">{stats.nextDueMinutes}</span>\r\n        \r\n        <span className=\"text-gray-400\">nextDueSeconds:</span>\r\n        <span className=\"text-white\">{stats.nextDueSeconds}</span>\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Progress Bar Calculations:</div>\r\n      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1\">\r\n        <span className=\"text-gray-400\">isScheduleStartDay:</span>\r\n        <span className={stats.isScheduleStartDay ? 'text-green-400' : 'text-white'}>{stats.isScheduleStartDay ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">isDueToday:</span>\r\n        <span className={stats.isDueToday ? 'text-green-400' : 'text-white'}>{stats.isDueToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">doseLoggedToday (global):</span>\r\n        <span className={doseLoggedToday ? 'text-green-400' : 'text-white'}>{doseLoggedToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">hasEntryToday (any):</span>\r\n        <span className={medicationEntries.some(e => e.date === todayStr) ? 'text-green-400' : 'text-white'}>{medicationEntries.some(e => e.date === todayStr) ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">hasManualEntryToday (any):</span>\r\n        <span className={medicationEntries.some(e => e.date === todayStr && e.isManual) ? 'text-green-400' : 'text-white'}>{medicationEntries.some(e => e.date === todayStr && e.isManual) ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">lastLoggedDate:</span>\r\n        <span className=\"text-yellow-400\">{localStorage.getItem('lastLoggedDate') || 'NULL'}</span>\r\n        \r\n        <span className=\"text-gray-400\">isOverdue (8+ days since last):</span>\r\n        <span className={stats.isOverdue ? 'text-red-400' : 'text-white'}>{stats.isOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">semaglutideIsOverdue:</span>\r\n        <span className={stats.semaglutideIsOverdue ? 'text-red-400' : 'text-white'}>{stats.semaglutideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">tirzepatideIsOverdue:</span>\r\n        <span className={stats.tirzepatideIsOverdue ? 'text-red-400' : 'text-white'}>{stats.tirzepatideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">retatrutideIsOverdue:</span>\r\n        <span className={stats.retatrutideIsOverdue ? 'text-red-400' : 'text-white'}>{stats.retatrutideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">cagrilintideIsOverdue:</span>\r\n        <span className={stats.cagrilintideIsOverdue ? 'text-red-400' : 'text-white'}>{stats.cagrilintideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">semaglutideEntryToday:</span>\r\n        <span className={stats.semaglutideEntryToday ? 'text-green-400' : 'text-white'}>{stats.semaglutideEntryToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">tirzepatideEntryToday:</span>\r\n        <span className={stats.tirzepatideEntryToday ? 'text-green-400' : 'text-white'}>{stats.tirzepatideEntryToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">retatrutideEntryToday:</span>\r\n        <span className={stats.retatrutideEntryToday ? 'text-green-400' : 'text-white'}>{stats.retatrutideEntryToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">cagrilintideEntryToday:</span>\r\n        <span className={stats.cagrilintideEntryToday ? 'text-green-400' : 'text-white'}>{stats.cagrilintideEntryToday ? 'TRUE' : 'FALSE'}</span>\r\n        \r\n        <span className=\"text-gray-400\">semaglutideDaysSinceLastDose:</span>\r\n        <span className={stats.semaglutideDaysSinceLastDose >= 8 ? 'text-red-400' : 'text-yellow-400'}>{stats.semaglutideDaysSinceLastDose}</span>\r\n        \r\n        <span className=\"text-gray-400\">tirzepatideDaysSinceLastDose:</span>\r\n        <span className={stats.tirzepatideDaysSinceLastDose >= 8 ? 'text-red-400' : 'text-yellow-400'}>{stats.tirzepatideDaysSinceLastDose}</span>\r\n        \r\n        <span className=\"text-gray-400\">retatrutideDaysSinceLastDose:</span>\r\n        <span className={stats.retatrutideDaysSinceLastDose >= 8 ? 'text-red-400' : 'text-yellow-400'}>{stats.retatrutideDaysSinceLastDose}</span>\r\n        \r\n        <span className=\"text-gray-400\">cagrilintideDaysSinceLastDose:</span>\r\n        <span className={stats.cagrilintideDaysSinceLastDose >= 8 ? 'text-red-400' : 'text-yellow-400'}>{stats.cagrilintideDaysSinceLastDose}</span>\r\n        \r\n        <span className=\"text-gray-400\">rawProgress (days/interval*100):</span>\r\n        <span className=\"text-yellow-400\">{stats.lastDoseDateStr === 'N/A' && !stats.isScheduleStartDay\r\n          ? '0'\r\n          : stats.lastDoseDateStr === 'N/A' && stats.isScheduleStartDay\r\n            ? '0'\r\n            : Math.min(80, Math.max(0, (stats.daysSinceLastDose / stats.intervalDays) * 100)).toFixed(2) + '%'}</span>\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Unique Meds in Entries:</div>\r\n      <div className=\"text-yellow-400 text-xs mb-1\">\r\n        {Array.from(new Set(medicationEntries.map(e => e.medication))).join(', ')}\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">Per-Med Status (Canonical Keys):</div>\r\n      <div className=\"grid grid-cols-2 gap-1 text-xs\">\r\n        <span className=\"text-gray-400\">semaglutide isOverdue:</span>\r\n        <span className={stats.semaglutideIsOverdue ? 'text-red-400' : 'text-green-400'}>{stats.semaglutideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        <span className=\"text-gray-400\">tirzepatide isOverdue:</span>\r\n        <span className={stats.tirzepatideIsOverdue ? 'text-red-400' : 'text-green-400'}>{stats.tirzepatideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        <span className=\"text-gray-400\">retatrutide isOverdue:</span>\r\n        <span className={stats.retatrutideIsOverdue ? 'text-red-400' : 'text-green-400'}>{stats.retatrutideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n        <span className=\"text-gray-400\">cagrilintide isOverdue:</span>\r\n        <span className={stats.cagrilintideIsOverdue ? 'text-red-400' : 'text-green-400'}>{stats.cagrilintideIsOverdue ? 'TRUE' : 'FALSE'}</span>\r\n      </div>\r\n      \r\n      <div className=\"text-red-300 mb-1\">All Medication Entries ({medicationEntries.length} total):</div>\r\n      <div className=\"grid grid-cols-1 gap-y-1 max-h-40 overflow-y-auto\">\r\n        {medicationEntries.slice(0, 20).map((entry, idx) => (\r\n          <div key={idx} className=\"grid grid-cols-3 gap-x-2 text-xs\">\r\n            <span className=\"text-yellow-400\">{entry.date}</span>\r\n            <span className=\"text-cyan-400\">{entry.medication}</span>\r\n            <span className={entry.isManual ? 'text-green-400' : 'text-gray-400'}>{entry.dose}mg {entry.isManual ? '(M)' : '(A)'}</span>\r\n          </div>\r\n        ))}\r\n        {medicationEntries.length > 20 && (\r\n          <span className=\"text-gray-400\">...and {medicationEntries.length - 20} more</span>\r\n        )}\r\n      </div>\r\n      \r\n      <div className=\"border-t border-red-500/20 my-2\"></div>\r\n      <div className=\"text-red-300 mb-1\">All Protocols ({protocols.length} total):</div>\r\n      <div className=\"grid grid-cols-1 gap-y-1 max-h-40 overflow-y-auto\">\r\n        {protocols.map((p, idx) => {\r\n          const isActive = todayStr >= p.startDate && todayStr <= (p.stopDate || '2099-12-31');\r\n          return (\r\n            <div key={idx} className=\"grid grid-cols-4 gap-x-1 text-xs\">\r\n              <span className={isActive ? 'text-green-400' : 'text-gray-400'}>{p.medication.substring(0, 8)}</span>\r\n              <span className=\"text-yellow-400\">{p.dose}mg</span>\r\n              <span className=\"text-gray-400\">{p.startDate}</span>\r\n              <span className={p.isArchived ? 'text-red-400' : 'text-white'}>{p.isArchived ? 'archived' : 'active'}</span>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MedicationTab;\r\n","import React, { useMemo, useCallback, useState, useRef } from 'react';\nimport ReactECharts from 'echarts-for-react';\nimport { GLP1Entry } from '../../../types';\nimport { useMedicationChartData } from '../../../shared/hooks/useChartDataProcessor';\nimport { useChartDateRange } from '../../../shared/hooks/useChartDateRange';\nimport { generateMedicationSeries } from '../../../shared/utils/medicationChartUtils';\nimport { CHART_COLORS } from '../../../shared/utils/chartUtils';\nimport ChartEmptyState from '../../../shared/components/ChartEmptyState';\nimport { useTime } from '../../../shared/hooks';\nimport { isMobile } from '../../../shared/utils/common';\n\nimport { ChartPeriod } from '../../../shared/hooks';\n\r\nconst shortenMedicationName = (name: string): string => {\r\n  return name.replace(/\\s*\\(.*?\\)/g, '').trim();\r\n};\r\n\r\ninterface MedicationChartProps {\r\n  data: GLP1Entry[];\r\n  period: ChartPeriod;\r\n  onLegendChange?: (visibleMeds: string[]) => void;\r\n}\r\n\r\nconst MedicationChart: React.FC<MedicationChartProps> = ({ data, period, onLegendChange }) => {\n  const chartRef = useRef<any>(null);\n  const { medications, medicationColors, dosesByMed, halfLifeByMed } =\n    useMedicationChartData(data);\n\n  // Use time service for simulated time\n  const now = useTime(1000);\n  const simulatedNow = new Date(now);\n\n  const firstDataDate = useMemo(\n    () =>\r\n      data.length > 0\r\n        ? new Date(Math.min(...data.map((d) => new Date(d.date).getTime())))\r\n        : new Date(),\r\n    [data]\r\n  );\r\n\r\n  const lastDataDate = useMemo(\r\n    () =>\r\n      data.length > 0\r\n        ? new Date(Math.max(...data.map((d) => new Date(d.date).getTime())))\r\n        : new Date(),\r\n    [data]\r\n  );\r\n\r\n  const extendedLastDate = useMemo(() => {\r\n    const futureDays = 60;\r\n    return new Date(lastDataDate.getTime() + futureDays * 24 * 60 * 60 * 1000);\r\n  }, [lastDataDate]);\r\n\r\n  const {\r\n    xAxisDates,\r\n    todayIndex,\r\n    zoomStart,\r\n    zoomEnd,\r\n    visibleStartIndex,\r\n    visibleEndIndex,\r\n  } = useChartDateRange(firstDataDate, extendedLastDate, period, 14, simulatedNow);\n\n  const chartOption = useMemo(() => {\n    if (data.length === 0) {\r\n      return {};\r\n    }\r\n\r\n    const series = generateMedicationSeries({\r\n      medications,\r\n      medicationColors,\r\n      dosesByMed,\r\n      halfLifeByMed,\r\n      firstDate: firstDataDate,\r\n      lastDate: extendedLastDate,\r\n      xAxisDates,\r\n      todayIndex,\r\n      visibleStartIndex,\r\n      visibleEndIndex,\r\n    });\r\n\r\n    const option = {\n      backgroundColor: 'transparent',\n      animation: !isMobile(),\n      tooltip: {\n        trigger: 'axis',\r\n        backgroundColor: 'rgba(20, 15, 35, 0.95)',\r\n        borderColor: 'rgba(177, 156, 217, 0.4)',\r\n        borderWidth: 1,\r\n        borderRadius: 12,\r\n        padding: [12, 16],\r\n        extraCssText:\r\n          'box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px);',\r\n        textStyle: { color: '#E2E8F0', fontSize: 13 },\r\n        formatter: (params: any) => {\r\n          if (!params || !params.length) return '';\r\n          const filteredParams = params.filter(\r\n            (p: any) => p.seriesType !== 'scatter'\r\n          );\r\n          const processedParams = filteredParams.map((p: any) => ({\r\n            ...p,\r\n            seriesName: p.seriesName?.replace('_future', '') || p.seriesName,\r\n          }));\r\n          const dedupedParams: any[] = [];\r\n          const seen = new Set<string>();\r\n          for (const p of processedParams) {\r\n            if (!seen.has(p.seriesName)) {\r\n              seen.add(p.seriesName);\r\n              dedupedParams.push(p);\r\n            }\r\n          }\r\n          const nonZeroParams = dedupedParams.filter(\r\n            (p: any) => (p.value?.[1] ?? 0) > 0\r\n          );\r\n          const dateStr = params[0].axisValue;\r\n          const dateIndex = xAxisDates.indexOf(dateStr);\r\n          const actualDate = dateIndex >= 0 ? new Date(firstDataDate.getTime() + dateIndex * 24 * 60 * 60 * 1000) : new Date();\r\n          const dateWithYear = `${dateStr} ${actualDate.getFullYear()}`;\r\n          if (nonZeroParams.length === 0)\r\n            return `${dateWithYear}<div style=\"color: #94a3b8; font-size: 11px;\">No active dose</div>`;\r\n          let html = `<div style=\"font-weight: 600; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid rgba(156, 123, 211, 0.2);\">${dateWithYear}</div>`;\r\n          nonZeroParams.forEach((item: any) => {\r\n            const color = item.color || '#9C7BD3';\r\n            const value = item.value?.[1] ?? 0;\r\n            const formattedValue = value < 1 ? value.toFixed(2) : value.toFixed(1);\r\n            const shortName = shortenMedicationName(item.seriesName);\r\n            html += `<div style=\"display: flex; align-items: center; gap: 10px; margin: 4px 0;\">\r\n              <span style=\"width: 10px; height: 10px; border-radius: 50%; background: ${color}; box-shadow: 0 0 6px ${color}80;\"></span>\r\n              <span style=\"color: #94a3b8;\">${shortName}:</span>\r\n              <span style=\"font-weight: 600; color: #fff;\">${formattedValue} mg</span>\r\n            </div>`;\r\n          });\r\n          return html;\r\n        },\r\n      },\r\n      legend: {\r\n        data: medications.length > 1 ? ['Combined', ...medications] : medications,\r\n        bottom: 0,\r\n        icon: 'circle',\r\n        itemWidth: 12,\r\n        itemHeight: 12,\r\n        textStyle: { fontSize: 12, color: '#94a3b8' },\r\n        formatter: (value: string) => shortenMedicationName(value),\r\n        tooltip: {\r\n          trigger: 'item',\r\n        },\r\n      },\r\n      dataZoom: [\n        {\n          type: 'inside',\n          start: zoomStart,\n          end: zoomEnd,\n          zoomOnMouseWheel: true,\n          moveOnMouseWheel: true,\n        },\n      ],\n      grid: {\r\n        top: 0,\r\n        left: 10,\r\n        right: 10,\r\n        bottom: 25,\r\n        containLabel: true,\r\n      },\r\n      xAxis: {\r\n        type: 'category',\r\n        data: xAxisDates,\r\n        boundaryGap: false,\r\n        axisLine: { lineStyle: { color: 'rgba(156, 123, 211, 0.2)' } },\r\n        axisTick: { lineStyle: { color: 'rgba(156, 123, 211, 0.2)' } },\r\n        axisLabel: { fontSize: 12, color: '#94a3b8' },\r\n        splitLine: { show: false },\r\n      },\r\n      yAxis: {\r\n        type: 'value',\r\n        position: 'right',\r\n        min: 0,\r\n        axisLine: { show: false },\r\n        axisTick: { show: false },\r\n        axisLabel: {\r\n          color: '#94a3b8',\r\n          fontSize: 11,\r\n          margin: 10,\r\n          formatter: (value: number) => value.toFixed(1) + 'mg',\r\n        },\r\n        splitLine: {\r\n          lineStyle: { color: 'rgba(156, 123, 211, 0.1)', type: 'dashed' },\r\n        },\r\n      },\r\n      series,\r\n    };\r\n\r\n    return option;\r\n  }, [\r\n    data,\r\n    medications,\r\n    medicationColors,\r\n    dosesByMed,\r\n    halfLifeByMed,\r\n    firstDataDate,\r\n    lastDataDate,\r\n    xAxisDates,\r\n    todayIndex,\r\n    zoomStart,\r\n    zoomEnd,\r\n    visibleStartIndex,\r\n    visibleEndIndex,\r\n  ]);\r\n\r\n  if (data.length === 0) {\r\n    return (\r\n      <ChartEmptyState\r\n        title=\"No dose data yet\"\r\n        description=\"Log your first dose to see the chart\"\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full h-full relative\">\r\n      <ReactECharts\r\n        ref={chartRef}\r\n        option={chartOption}\r\n        style={{ height: '100%', width: '100%', opacity: 1 }}\r\n        opts={{ renderer: 'svg' }}\r\n        onEvents={{\r\n          'legendselectchanged': (params: any) => {\r\n            const { selected, name } = params;\r\n            const chart = chartRef.current?.getEchartsInstance();\r\n            if (!chart) return;\r\n            \r\n            const isSelected = selected[name];\r\n            \r\n            if (name === 'Combined') {\r\n              chart.dispatchAction({\r\n                type: isSelected ? 'legendSelect' : 'legendUnSelect',\r\n                name: 'Combined_future',\r\n              });\r\n            }\r\n            \r\n            medications.forEach((med) => {\r\n              if (name === med) {\r\n                chart.dispatchAction({\r\n                  type: isSelected ? 'legendSelect' : 'legendUnSelect',\r\n                  name: med + '_future',\r\n                });\r\n              }\r\n            });\r\n          },\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MedicationChart;\r\n","import { GLP1Entry } from '../../types';\r\nimport { calculateMedicationConcentration } from './calculations';\r\nimport { CHART_COLORS } from './chartUtils';\r\n\r\ninterface MedicationSeriesParams {\r\n  medications: string[];\r\n  medicationColors: Record<string, { stroke: string; fill: string }>;\r\n  dosesByMed: Record<string, { date: Date; dose: number }[]>;\r\n  halfLifeByMed: Record<string, number>;\r\n  firstDate: Date;\r\n  lastDate: Date;\r\n  xAxisDates: string[];\r\n  todayIndex: number;\r\n  visibleStartIndex: number;\r\n  visibleEndIndex: number;\r\n}\r\n\r\nexport const generateMedicationSeries = ({\r\n  medications,\r\n  medicationColors,\r\n  dosesByMed,\r\n  halfLifeByMed,\r\n  firstDate,\r\n  lastDate,\r\n  xAxisDates,\r\n  todayIndex,\r\n  visibleStartIndex,\r\n  visibleEndIndex,\r\n}: MedicationSeriesParams) => {\r\n  const doseDatesByMed: Record<string, Set<string>> = {};\r\n  const doseAmountByMed: Record<string, Record<string, number>> = {};\r\n  const combinedDoseDates = new Set<string>();\r\n  const combinedDoseAmounts: Record<string, number> = {};\r\n\r\n  medications.forEach((med) => {\r\n    doseDatesByMed[med] = new Set();\r\n    doseAmountByMed[med] = {};\r\n    dosesByMed[med].forEach((d) => {\r\n      const peakDate = new Date(d.date.getTime() + 24 * 60 * 60 * 1000);\r\n      const dateKey = peakDate.toLocaleDateString('en-US', {\r\n        month: 'short',\r\n        day: 'numeric',\r\n      });\r\n      doseDatesByMed[med].add(dateKey);\r\n      doseAmountByMed[med][dateKey] = d.dose;\r\n      combinedDoseDates.add(dateKey);\r\n      combinedDoseAmounts[dateKey] = (combinedDoseAmounts[dateKey] || 0) + d.dose;\r\n    });\r\n  });\r\n\r\n  const combinedColor = CHART_COLORS.combined;\r\n  const combinedSeries: any[] = [];\r\n  const combinedLineDataBefore: any[] = [];\r\n  const combinedLineDataAfter: any[] = [];\r\n  const combinedDoseData: any[] = [];\r\n\r\n  const combinedDoseDatesArray = Array.from(combinedDoseDates);\r\n  \r\n  const iterateDate = new Date(firstDate);\r\n  while (iterateDate <= lastDate) {\r\n    let totalConcentration = 0;\r\n    medications.forEach((med) => {\r\n      totalConcentration += calculateMedicationConcentration(\r\n        dosesByMed[med],\r\n        halfLifeByMed[med],\r\n        new Date(iterateDate)\r\n      );\r\n    });\r\n\r\n    const dateStr = iterateDate.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n    });\r\n    const hasDose = combinedDoseDates.has(dateStr);\r\n    const dose = hasDose ? combinedDoseAmounts[dateStr] : undefined;\r\n    const value = isNaN(totalConcentration) ? null : totalConcentration;\r\n\r\n    const dateIndex = xAxisDates.indexOf(dateStr);\r\n    if (dateIndex <= todayIndex) {\r\n      combinedLineDataBefore.push([dateStr, value]);\r\n    }\r\n    if (dateIndex >= todayIndex) {\r\n      combinedLineDataAfter.push([dateStr, value]);\r\n    }\r\n\r\n    if (dose) {\r\n      combinedDoseData.push({\r\n        name: dateStr,\r\n        value: [dateStr, value],\r\n        symbol: 'circle',\r\n        symbolSize: 10,\r\n        itemStyle: {\r\n          color: combinedColor.stroke,\r\n          borderColor: '#2D1B4E',\r\n          borderWidth: 2,\r\n          shadowBlur: 8,\r\n          shadowColor: combinedColor.stroke + '99',\r\n        },\r\n      });\r\n    }\r\n\r\n    iterateDate.setDate(iterateDate.getDate() + 1);\r\n  }\r\n\r\n  if (medications.length > 0) {\r\n    combinedSeries.push(\r\n      {\r\n        name: 'Combined',\r\n        type: 'line',\r\n        smooth: true,\r\n        showSymbol: false,\r\n        symbol: 'none',\r\n        itemStyle: { color: combinedColor.stroke },\r\n        lineStyle: { width: 2, color: combinedColor.stroke },\r\n        areaStyle: {\r\n          color: {\r\n            type: 'linear',\r\n            x: 0,\r\n            y: 0,\r\n            x2: 0,\r\n            y2: 1,\r\n            colorStops: [\r\n              { offset: 0, color: combinedColor.fill },\r\n              { offset: 1, color: combinedColor.fill.replace('0.3', '0.02') },\r\n            ],\r\n          },\r\n        },\r\n        emphasis: {\r\n          lineStyle: { width: 3 },\r\n          itemStyle: { opacity: 0 },\r\n        },\r\n        triggerLineEvent: false,\r\n        data: combinedLineDataBefore,\r\n      },\r\n      {\r\n        name: 'Combined_future',\r\n        type: 'line',\r\n        smooth: true,\r\n        showSymbol: false,\r\n        symbol: 'none',\r\n        showInLegend: false,\r\n        lineStyle: { width: 2, color: combinedColor.stroke, type: 'dotted' },\r\n        emphasis: {\r\n          disabled: true,\r\n        },\r\n        triggerLineEvent: false,\r\n        data: combinedLineDataAfter,\r\n      },\r\n      {\r\n        name: 'Combined',\r\n        type: 'scatter',\r\n        z: 10,\r\n        showInLegend: false,\r\n        emphasis: {\r\n          scale: 1.2,\r\n        },\r\n        data: combinedDoseData,\r\n      }\r\n    );\r\n  }\r\n\r\n  combinedSeries.forEach((s: any) => {\r\n    if (s.type === 'scatter' && s.data && s.data.length > 0) {\r\n      let lastShownValue: number | null = null;\r\n      s.data = s.data.map((dot: any) => {\r\n        const doseValue = dot.value[1];\r\n        let shouldShow = true;\r\n        if (lastShownValue !== null && lastShownValue > 0) {\r\n          const diff = Math.abs(doseValue - lastShownValue) / lastShownValue;\r\n          if (diff <= 0.25) {\r\n            shouldShow = false;\r\n          }\r\n        }\r\n        if (shouldShow) {\r\n          lastShownValue = doseValue;\r\n          const formattedDoseValue = doseValue < 1 ? doseValue.toFixed(2) : doseValue.toFixed(1);\r\n          return {\r\n            ...dot,\r\n            label: {\r\n              show: true,\r\n              position: 'top',\r\n              formatter: formattedDoseValue + 'mg',\r\n              color: '#E2E8F0',\r\n              fontSize: 10,\r\n              distance: 8,\r\n              backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n              borderRadius: 4,\r\n              borderColor: 'rgba(0,0,0,0.4)',\r\n              borderWidth: 1,\r\n              padding: [2, 2],\r\n              textShadowColor: 'rgba(0,0,0,0.8)',\r\n              textShadowBlur: 4,\r\n              textShadowOffsetX: 1,\r\n              textShadowOffsetY: 1,\r\n            },\r\n          };\r\n        }\r\n        return { ...dot, label: { show: false } };\r\n      });\r\n    }\r\n  });\r\n\r\n  combinedSeries.forEach((s: any) => {\r\n    if (s.type === 'scatter' && s.data && s.data.length > 0) {\r\n      const visibleDots = s.data.filter((dot: any) => {\r\n        const dotIndex = xAxisDates.indexOf(dot.value[0]);\r\n        return dotIndex >= visibleStartIndex && dotIndex <= visibleEndIndex;\r\n      });\r\n      if (visibleDots.length > 6) {\r\n        const step = Math.floor(visibleDots.length / 6);\r\n        s.data = visibleDots\r\n          .filter((_: any, i: number) => i % step === 0)\r\n          .slice(0, 6);\r\n      }\r\n    }\r\n  });\r\n\r\n  const series: any[] = medications.map((med) => {\r\n    const lineDataBefore: any[] = [];\r\n    const lineDataAfter: any[] = [];\r\n    const doseData: any[] = [];\r\n    const color = medicationColors[med];\r\n\r\n    const iterateDate = new Date(firstDate);\r\n    while (iterateDate <= lastDate) {\r\n      const concentration = calculateMedicationConcentration(\r\n        dosesByMed[med],\r\n        halfLifeByMed[med],\r\n        new Date(iterateDate)\r\n      );\r\n\r\n      const dateStr = iterateDate.toLocaleDateString('en-US', {\r\n        month: 'short',\r\n        day: 'numeric',\r\n      });\r\n      const hasDose = doseDatesByMed[med].has(dateStr);\r\n      const dose = hasDose ? doseAmountByMed[med][dateStr] : undefined;\r\n      const value = isNaN(concentration)\r\n        ? null\r\n        : concentration;\r\n\r\n      const dateIndex = xAxisDates.indexOf(dateStr);\r\n      if (dateIndex <= todayIndex) {\r\n        lineDataBefore.push([dateStr, value]);\r\n      }\r\n      if (dateIndex >= todayIndex) {\r\n        lineDataAfter.push([dateStr, value]);\r\n      }\r\n\r\n      if (dose) {\r\n        doseData.push({\r\n          name: dateStr,\r\n          value: [dateStr, value],\r\n          symbol: 'circle',\r\n          symbolSize: 10,\r\n          itemStyle: {\r\n            color: color.stroke,\r\n            borderColor: '#2D1B4E',\r\n            borderWidth: 2,\r\n            shadowBlur: 8,\r\n            shadowColor: color.stroke + '99',\r\n          },\r\n        });\r\n      }\r\n\r\n      iterateDate.setDate(iterateDate.getDate() + 1);\r\n    }\r\n\r\n    return [\r\n      {\r\n        name: med,\r\n        type: 'line',\r\n        smooth: true,\r\n        showSymbol: false,\r\n        symbol: 'none',\r\n        itemStyle: { color: color.stroke },\r\n        lineStyle: { width: 2, color: color.stroke },\r\n        areaStyle: {\r\n          color: {\r\n            type: 'linear',\r\n            x: 0,\r\n            y: 0,\r\n            x2: 0,\r\n            y2: 1,\r\n            colorStops: [\r\n              { offset: 0, color: color.fill },\r\n              { offset: 1, color: color.fill.replace('0.3', '0.02') },\r\n            ],\r\n          },\r\n        },\r\n        emphasis: {\r\n          lineStyle: { width: 3 },\r\n          itemStyle: { opacity: 0 },\r\n        },\r\n        triggerLineEvent: false,\r\n        data: lineDataBefore,\r\n      },\r\n      {\r\n        name: med + '_future',\r\n        type: 'line',\r\n        smooth: true,\r\n        showSymbol: false,\r\n        symbol: 'none',\r\n        showInLegend: false,\r\n        lineStyle: { width: 2, color: color.stroke, type: 'dotted' },\r\n        emphasis: {\r\n          disabled: true,\r\n        },\r\n        triggerLineEvent: false,\r\n        data: lineDataAfter,\r\n      },\r\n      {\r\n        name: med,\r\n        type: 'scatter',\r\n        z: 10,\r\n        showInLegend: false,\r\n        emphasis: {\r\n          scale: 1.2,\r\n        },\r\n        data: doseData,\r\n      },\r\n    ];\r\n  }).flat();\r\n\r\n  series.forEach((s: any) => {\r\n    if (s.type === 'scatter' && s.data && s.data.length > 0) {\r\n      let lastShownValue: number | null = null;\r\n\r\n      s.data = s.data.map((dot: any) => {\r\n        const doseValue = dot.value[1];\r\n\r\n        let shouldShow = true;\r\n        if (lastShownValue !== null && lastShownValue > 0) {\r\n          const diff = Math.abs(doseValue - lastShownValue) / lastShownValue;\r\n          if (diff <= 0.25) {\r\n            shouldShow = false;\r\n          }\r\n        }\r\n\r\n        if (shouldShow) {\r\n          lastShownValue = doseValue;\r\n          const formattedDoseValue = doseValue < 1 ? doseValue.toFixed(2) : doseValue.toFixed(1);\r\n          return {\r\n            ...dot,\r\n            label: {\r\n              show: true,\r\n              position: 'top',\r\n              formatter: formattedDoseValue + 'mg',\r\n              color: '#E2E8F0',\r\n              fontSize: 10,\r\n              distance: 8,\r\n              backgroundColor: 'rgba(0, 0, 0, 0.8)',\r\n              borderRadius: 4,\r\n              borderColor: 'rgba(0,0,0,0.4)',\r\n              borderWidth: 1,\r\n              padding: [2, 2],\r\n              textShadowColor: 'rgba(0,0,0,0.8)',\r\n              textShadowBlur: 4,\r\n              textShadowOffsetX: 1,\r\n              textShadowOffsetY: 1,\r\n            },\r\n          };\r\n        }\r\n\r\n        return { ...dot, label: { show: false } };\r\n      });\r\n    }\r\n  });\r\n\r\n  series.forEach((s: any) => {\r\n    if (s.type === 'scatter' && s.data && s.data.length > 0) {\r\n      const visibleDots = s.data.filter((dot: any) => {\r\n        const dotIndex = xAxisDates.indexOf(dot.value[0]);\r\n        return dotIndex >= visibleStartIndex && dotIndex <= visibleEndIndex;\r\n      });\r\n\r\n      if (visibleDots.length > 6) {\r\n        const step = Math.floor(visibleDots.length / 6);\r\n        s.data = visibleDots\r\n          .filter((_: any, i: number) => i % step === 0)\r\n          .slice(0, 6);\r\n      }\r\n    }\r\n  });\r\n\r\n  if (todayIndex >= 0) {\r\n    const todayDateStr = xAxisDates[todayIndex];\r\n    const markLineConfig = {\r\n      silent: true,\r\n      symbol: 'none',\r\n      z: 100,\r\n      label: { show: false },\r\n      lineStyle: { type: 'dotted', width: 2, color: '#94A3B8' },\r\n      data: [{ xAxis: todayDateStr }],\r\n    };\r\n\r\n    const todayLineSeries = {\r\n      name: 'Today',\r\n      type: 'line',\r\n      markLine: markLineConfig,\r\n      data: [],\r\n      silent: true,\r\n      animation: false,\r\n      lineStyle: { opacity: 0 },\r\n      areaStyle: { opacity: 0 },\r\n    };\r\n\r\n    if (combinedSeries.length > 0) {\r\n      (combinedSeries[2] as any).markLine = markLineConfig;\r\n    }\r\n    if (series.length > 0) {\r\n      (series[2] as any).markLine = markLineConfig;\r\n    }\r\n\r\n    return [...(medications.length > 1 ? combinedSeries : []), ...series, todayLineSeries];\r\n  }\r\n\r\n  return [...(medications.length > 1 ? combinedSeries : []), ...series];\r\n};\r\n","import React, { useRef, useEffect } from 'react';\nimport { format, startOfMonth, endOfMonth, eachDayOfInterval, getDay, isSameMonth, isSameDay, isToday, addMonths, subMonths } from 'date-fns';\n\ninterface DatePickerProps {\n  selected: Date | undefined;\n  onSelect: (date: Date | undefined) => void;\n  month: Date;\n  isDarkMode?: boolean;\n  // Called when user clicks the \"Today\" button. Receives the date representing \"today\".\n  onTodayClick?: (date: Date) => void;\n}\n\nconst DatePicker: React.FC<DatePickerProps> = ({\n  selected,\n  onSelect,\n  month,\n  isDarkMode = false,\n  onTodayClick,\n}) => {\n  // Show 13-month window: 6 months past, current month, 6 months future\n  const months = Array.from({ length: 13 }, (_, idx) => addMonths(month, idx - 6));\n  \n  const scrollRef = useRef<HTMLDivElement>(null);\n  const isFirstRender = useRef(true);\n  \n  useEffect(() => {\n    if (scrollRef.current && isFirstRender.current) {\n      const container = scrollRef.current;\n      const middleIndex = 6;\n      setTimeout(() => {\n        const middleMonthEl = container.children[middleIndex] as HTMLElement;\n        if (middleMonthEl) {\n          middleMonthEl.scrollIntoView({ behavior: 'auto', block: 'center' });\n        }\n        isFirstRender.current = false;\n      }, 100);\n    }\n  }, []);\n\n  const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  const textColor = isDarkMode ? '#ffffff' : '#374151';\n  const outsideColor = isDarkMode ? 'rgba(255, 255, 255, 0.25)' : 'rgba(0, 0, 0, 0.15)';\n  const weekdayColor = isDarkMode ? '#9CA3AF' : '#6B7280';\n  const accentColor = isDarkMode ? '#B19CD9' : '#9C7BD3';\n  const todayColor = '#4ADEA8';\n\n  const handleDayClick = (day: Date) => {\n    onSelect(day);\n  };\n\n  const getMonthDays = (monthDate: Date) => {\n    const start = startOfMonth(monthDate);\n    const end = endOfMonth(monthDate);\n    return eachDayOfInterval({ start, end });\n  };\n\n  const renderMonth = (monthDate: Date, index: number) => {\n    const days = getMonthDays(monthDate);\n    const startDayOfWeek = getDay(startOfMonth(monthDate));\n    const monthLabel = format(monthDate, 'MMMM yyyy');\n\n    return (\n      <div key={monthDate.toISOString()} className=\"mb-4 last:mb-0\">\n        <div\n          className=\"text-center text-sm font-semibold mb-2\"\n          style={{ color: weekdayColor }}\n        >\n          {monthLabel}\n        </div>\n        <div className=\"grid grid-cols-7 mb-2\">\n          {weekDays.map((day) => (\n            <div\n              key={day}\n              className=\"text-center text-xs font-medium uppercase\"\n              style={{ color: weekdayColor }}\n            >\n              {day}\n            </div>\n          ))}\n        </div>\n        <div className=\"grid grid-cols-7 gap-1\">\n          {Array.from({ length: startDayOfWeek }).map((_, i) => (\n            <div key={`empty-${i}`} className=\"aspect-square\" />\n          ))}\n          {days.map((day) => {\n            const isSelected = selected && isSameDay(day, selected);\n            const isCurrentDay = isToday(day);\n            const isCurrentMonth = isSameMonth(day, month);\n\n            return (\n              <button\n                key={day.toISOString()}\n                type=\"button\"\n                onClick={() => handleDayClick(day)}\n                className=\"aspect-square rounded-lg flex items-center justify-center text-sm transition-all\"\n                style={{\n                  color: !isCurrentMonth\n                    ? outsideColor\n                    : isSelected\n                    ? '#ffffff'\n                    : textColor,\n                  backgroundColor: isSelected\n                    ? accentColor\n                    : 'transparent',\n                  fontWeight: isCurrentDay && !isSelected ? '600' : '400',\n                  border: isCurrentDay && !isSelected ? `2px solid ${todayColor}` : 'none',\n                }}\n              >\n                {format(day, 'd')}\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"w-full\">\n      {onTodayClick && (\n        <div className=\"flex justify-center mb-3\">\n          <button\n            type=\"button\"\n            onClick={() => onTodayClick ? onTodayClick(new Date()) : undefined}\n            className=\"text-xs font-medium px-3 py-1 rounded-full transition-colors\"\n            style={{\n              backgroundColor: isDarkMode ? 'rgba(74, 222, 168, 0.2)' : 'rgba(74, 222, 168, 0.15)',\n              color: todayColor,\n            }}\n          >\n            Today\n          </button>\n        </div>\n      )}\n      <div ref={scrollRef} className=\"overflow-y-auto max-h-[500px] pr-1\">\n        {months.map((monthDate, index) => renderMonth(monthDate, index))}\n      </div>\n    </div>\n  );\n};\n\nexport default DatePicker;\n","import React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport { format, addMonths, subMonths } from 'date-fns';\nimport { useTheme } from '../../contexts/ThemeContext';\nimport DatePicker from './DatePicker';\n\ninterface CalendarPickerModalProps {\n  isOpen: boolean;\n  value: string;\n  onChange: (date: string) => void;\n  onClose: () => void;\n}\n\nconst CalendarPickerModal: React.FC<CalendarPickerModalProps> = ({\n  isOpen,\n  value,\n  onChange,\n  onClose,\n}) => {\n  const { isDarkMode } = useTheme();\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(\n    value ? new Date(value) : undefined\n  );\n  const getInitialMonth = () => {\n    if (value) {\n      const parsed = new Date(value);\n      return new Date(parsed.getFullYear(), parsed.getMonth(), 1);\n    }\n    const today = new Date();\n    return new Date(today.getFullYear(), today.getMonth(), 1);\n  };\n  const [currentMonth, setCurrentMonth] = useState<Date>(getInitialMonth());\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n\n  const months = [\n    'January', 'February', 'March', 'April', 'May', 'June',\n    'July', 'August', 'September', 'October', 'November', 'December'\n  ];\n  \n  const currentYear = new Date().getFullYear();\n  const years = Array.from({ length: 20 }, (_, i) => currentYear - 10 + i);\n\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      setSelectedDate(value ? new Date(value) : undefined);\n      setCurrentMonth(getInitialMonth());\n    }\n  }, [isOpen, value]);\n\n  const handleSelect = (date: Date | undefined) => {\n    setSelectedDate(date);\n    if (date) {\n      onChange(format(date, 'yyyy-MM-dd'));\n      handleClose();\n    }\n  };\n\n  const handleClose = () => {\n    if (isClosing) return;\n    setIsClosing(true);\n    const timer = setTimeout(() => {\n      setIsVisible(false);\n      setIsClosing(false);\n      onClose();\n    }, 200);\n    return () => clearTimeout(timer);\n  };\n\n  const handlePrevMonth = () => {\n    setCurrentMonth(subMonths(currentMonth, 1));\n  };\n\n  const handleNextMonth = () => {\n    setCurrentMonth(addMonths(currentMonth, 1));\n  };\n\n  const handleMonthChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newMonth = parseInt(e.target.value);\n    setCurrentMonth(new Date(currentMonth.getFullYear(), newMonth, 1));\n  };\n\n  const handleYearChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newYear = parseInt(e.target.value);\n    setCurrentMonth(new Date(newYear, currentMonth.getMonth(), 1));\n  };\n\n  if (!isVisible) return null;\n\n  const modal = (\n    <div className=\"fixed inset-0 z-[99999] flex items-center justify-center p-4\">\n      <div\n        className={`absolute inset-0 bg-black/60 ${\n          isClosing ? 'backdrop-fade-out' : 'backdrop-fade-in'\n        }`}\n        style={{ backdropFilter: 'blur(8px)' }}\n        onClick={handleClose}\n      />\n\n      <div className=\"relative w-full max-w-sm\">\n        <div\n          className={`relative isolate rounded-2xl border shadow-2xl p-4 max-h-[90vh] overflow-y-auto transition-all ${\n            isDarkMode \n              ? 'border-[#B19CD9]/30 bg-gradient-to-b from-[#1a1625]/95 to-[#0d0a15]/95'\n              : 'border-gray-200 bg-white'\n          } ${\n            isClosing\n              ? 'modal-fade-out'\n              : 'modal-content-fade-in'\n          }`}\n          style={isDarkMode ? {\n            boxShadow: '0 0 30px rgba(177, 156, 217, 0.3)',\n          } : {}}\n        >\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className={`text-lg font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n              Select Date\n            </h3>\n            <button\n              onClick={handleClose}\n              className={`p-1 rounded-lg transition-colors ${\n                isDarkMode ? 'text-gray-400 hover:text-white' : 'text-gray-500 hover:text-gray-700'\n              }`}\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n              </svg>\n            </button>\n          </div>\n\n          <div className=\"flex items-center justify-between mb-4\">\n            <button\n              type=\"button\"\n              onClick={handlePrevMonth}\n              className={`p-2 rounded-lg transition-colors ${\n                isDarkMode ? 'text-[#B19CD9] hover:bg-[#B19CD9]/20' : 'text-[#9C7BD3] hover:bg-[#9C7BD3]/10'\n              }`}\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n              </svg>\n            </button>\n            \n            <div className=\"flex items-center gap-2\">\n              <select\n                value={currentMonth.getMonth()}\n                onChange={handleMonthChange}\n                className={`text-sm font-semibold bg-transparent border-none cursor-pointer focus:outline-none ${\n                  isDarkMode ? 'text-white' : 'text-gray-900'\n                }`}\n              >\n                {months.map((month, index) => (\n                  <option key={month} value={index} className={isDarkMode ? 'bg-[#1a1625]' : 'bg-white'}>\n                    {month}\n                  </option>\n                ))}\n              </select>\n              <select\n                value={currentMonth.getFullYear()}\n                onChange={handleYearChange}\n                className={`text-sm font-semibold bg-transparent border-none cursor-pointer focus:outline-none ${\n                  isDarkMode ? 'text-white' : 'text-gray-900'\n                }`}\n              >\n                {years.map((year) => (\n                  <option key={year} value={year} className={isDarkMode ? 'bg-[#1a1625]' : 'bg-white'}>\n                    {year}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <button\n              type=\"button\"\n              onClick={handleNextMonth}\n              className={`p-2 rounded-lg transition-colors ${\n                isDarkMode ? 'text-[#B19CD9] hover:bg-[#B19CD9]/20' : 'text-[#9C7BD3] hover:bg-[#9C7BD3]/10'\n              }`}\n            >\n              <svg className=\"w-5 h-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\n              </svg>\n            </button>\n          </div>\n\n          <DatePicker\n            key={currentMonth.toISOString()}\n            selected={selectedDate}\n            onSelect={handleSelect}\n            month={currentMonth}\n            isDarkMode={isDarkMode}\n            onTodayClick={(date) => {\n              // Jump to today and reflect selection in the picker view\n              // Use the first day of the month to ensure the view centers on the correct month\n              const firstOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);\n              setCurrentMonth(firstOfMonth);\n              setSelectedDate(date);\n            }}\n          />\n\n          <div className=\"flex gap-2 mt-4\">\n            <button\n              onClick={handleClose}\n              className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              Cancel\n            </button>\n            <button\n              onClick={() => {\n                if (selectedDate) {\n                  onChange(format(selectedDate, 'yyyy-MM-dd'));\n                  handleClose();\n                }\n              }}\n              disabled={!selectedDate}\n              className={`flex-1 py-3 rounded-xl font-medium transition-all ${\n                selectedDate\n                  ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white hover:shadow-[0_0_20px_rgba(177,156,217,0.5)]'\n                  : isDarkMode\n                    ? 'bg-[#B19CD9]/30 text-white/50 cursor-not-allowed'\n                    : 'bg-[#B19CD9]/30 text-gray-400 cursor-not-allowed'\n              }`}\n            >\n              Confirm\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n\n  return ReactDOM.createPortal(modal, document.body);\n};\n\nexport default CalendarPickerModal;\n","import React from 'react';\n\ninterface ChartEmptyStateProps {\n  title: string;\n  description: string;\n}\n\nconst ChartEmptyState: React.FC<ChartEmptyStateProps> = ({\n  title,\n  description,\n}) => {\n  return (\n    <div className=\"w-full h-full flex flex-col items-center justify-center\">\n      <div className=\"text-center text-text-muted\">\n        <p className=\"text-sm\">{title}</p>\n        <p className=\"text-xs mt-1\">{description}</p>\n      </div>\n    </div>\n  );\n};\n\nexport default ChartEmptyState;\n","import React, { useState, useMemo, useEffect } from 'react';\nimport WheelPicker from './WheelPicker';\nimport { timeService } from '../../core/timeService';\nimport { useTheme } from '../../contexts/ThemeContext';\n\nconst getToday = () => new Date(timeService.now());\n\r\ninterface DateWheelPickerModalProps {\r\n  isOpen: boolean;\r\n  value: string;\r\n  onChange: (date: string) => void;\r\n  onClose: () => void;\r\n  minDate?: string;\r\n  maxDate?: string;\r\n}\r\n\r\nconst DateWheelPickerModal: React.FC<DateWheelPickerModalProps> = ({\n  isOpen,\n  value,\n  onChange,\n  onClose,\n  minDate,\n  maxDate,\n}) => {\n  const { isDarkMode } = useTheme();\n  const [localDate, setLocalDate] = useState(value);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const [isClosing, setIsClosing] = useState(false);\r\n\r\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      setLocalDate(value);\n    }\n  }, [isOpen, value]);\n\n  const handleClose = () => {\n    if (isClosing) return;\n    setIsClosing(true);\n    const timer = setTimeout(() => {\n      setIsVisible(false);\n      setIsClosing(false);\n      onClose();\n    }, 200);\n    return () => clearTimeout(timer);\n  };\n\r\n  const { year, month, day } = useMemo(() => {\r\n    const [y, m, d] = localDate.split('-');\r\n    return { year: y, month: m, day: d };\r\n  }, [localDate]);\r\n\r\n  const years = useMemo(() => {\n    const currentYear = getToday().getFullYear();\n    const startYear = minDate\r\n      ? new Date(minDate).getFullYear()\r\n      : currentYear - 10;\r\n    const endYear = maxDate\r\n      ? new Date(maxDate).getFullYear()\r\n      : currentYear + 10;\r\n\r\n    return Array.from(\r\n      { length: endYear - startYear + 1 },\r\n      (_, i) => String(startYear + i)\r\n    );\r\n  }, [minDate, maxDate]);\r\n\r\n  const months = useMemo(\r\n    () =>\r\n      Array.from({ length: 12 }, (_, i) =>\r\n        String(i + 1).padStart(2, '0')\r\n      ),\r\n    []\r\n  );\r\n\r\n  const daysInMonth = useMemo(\r\n    () =>\r\n      new Date(parseInt(year), parseInt(month), 0).getDate(),\r\n    [year, month]\r\n  );\r\n\r\n  const days = useMemo(\r\n    () =>\r\n      Array.from({ length: daysInMonth }, (_, i) =>\r\n        String(i + 1).padStart(2, '0')\r\n      ),\r\n    [daysInMonth]\r\n  );\r\n\r\n  const monthNames = [\r\n    'Jan','Feb','Mar','Apr','May','Jun',\r\n    'Jul','Aug','Sep','Oct','Nov','Dec'\r\n  ];\r\n\r\n  if (!isVisible) return null;\r\n\r\n  const handleChange = (\r\n    type: 'year' | 'month' | 'day',\r\n    newValue: string\r\n  ) => {\r\n    let newYear = parseInt(year);\r\n    let newMonth = parseInt(month);\r\n    let newDay = parseInt(day);\r\n\r\n    if (type === 'year') newYear = parseInt(newValue);\r\n    if (type === 'month') newMonth = parseInt(newValue);\r\n    if (type === 'day') newDay = parseInt(newValue);\r\n\r\n    const daysInNewMonth = new Date(\r\n      newYear,\r\n      newMonth,\r\n      0\r\n    ).getDate();\r\n\r\n    if (newDay > daysInNewMonth) {\r\n      newDay = daysInNewMonth;\r\n    }\r\n\r\n    const formatted = `${newYear}-${String(\r\n      newMonth\r\n    ).padStart(2, '0')}-${String(newDay).padStart(\r\n      2,\r\n      '0'\r\n    )}`;\r\n\r\n    setLocalDate(formatted);\r\n  };\r\n\r\n  const handleDone = () => {\n    onChange(localDate);\n    handleClose();\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[10001] flex items-center justify-center p-4\">\n      <div\n        className={`fixed inset-0 bg-black/40 ${\n          isClosing\n            ? 'backdrop-fade-out'\n            : 'backdrop-fade-in'\n        }`}\n        style={{ backdropFilter: 'blur(8px)' }}\n        onClick={handleClose}\n      />\n\r\n      <div className=\"relative w-full max-w-sm\">\n        <div\n          className={`relative isolate rounded-2xl border shadow-2xl p-6 max-h-[90vh] overflow-y-auto transition-all ${\n            isDarkMode \n              ? 'border-[#B19CD9]/30 bg-gradient-to-b from-[#1a1625]/95 to-[#0d0a15]/95'\n              : 'border-gray-200 bg-white'\n          } ${\n            isClosing\n              ? 'modal-fade-out'\n              : 'modal-content-fade-in'\n          }`}\n        >\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n              Select Date\n            </h3>\n            <div className=\"w-8\" />\n          </div>\n          <div className={`border-t mb-3 ${isDarkMode ? 'border-[#B19CD9]/20' : 'border-gray-200'}`}></div>\n\n          <div className=\"flex items-center justify-center gap-3 mb-4 px-4\">\n            <WheelPicker\r\n              value={month}\r\n              onChange={(v) =>\r\n                handleChange('month', v)\r\n              }\r\n              options={months}\r\n              format={(v) =>\r\n                monthNames[parseInt(v) - 1]\r\n              }\r\n            />\r\n\r\n            <WheelPicker\r\n              value={day}\r\n              onChange={(v) =>\r\n                handleChange('day', v)\r\n              }\r\n              options={days}\r\n            />\r\n\r\n            <WheelPicker\r\n              value={year}\r\n              onChange={(v) =>\r\n                handleChange('year', v)\r\n              }\r\n              options={years}\r\n            />\n          </div>\n\n          <div className=\"border-t border-[#B19CD9]/20 my-3\"></div>\n\n          <div className=\"flex gap-3\">\n            <button\n              onClick={handleClose}\n              className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              Cancel\n            </button>\n\r\n            <button\r\n              onClick={handleDone}\r\n              className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white font-medium hover:shadow-[0_0_20px_rgba(177,156,217,0.5)] transition-all\"\r\n            >\r\n              Done\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DateWheelPickerModal;\r\n","import React, { useState, useMemo, useEffect, useLayoutEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport WheelPicker from './WheelPicker';\nimport { useTheme } from '../../contexts/ThemeContext';\n\ninterface DoseWheelPickerModalProps {\n  isOpen: boolean;\n  onSave: (value: string) => void;\n  onClose: () => void;\n  min?: number;\n  max?: number;\n  step?: number;\n  label?: string;\n  decimals?: number;\n  defaultValue?: string;\n  presets?: string[];\n}\n\nconst DoseWheelPickerModal: React.FC<DoseWheelPickerModalProps> = ({\n  isOpen,\n  onSave,\n  onClose,\n  min = 0,\n  max = 100,\n  step = 1,\n  label = 'Select Dose',\n  decimals = 2,\n  defaultValue,\n  presets,\n}) => {\n  const { isDarkMode } = useTheme();\n  const [localValue, setLocalValue] = useState(defaultValue || '0.25');\n  const [isVisible, setIsVisible] = useState(false);\n  const [isClosing, setIsClosing] = useState(false);\n\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true);\n      setIsClosing(false);\n      setLocalValue(defaultValue || '0.25');\n    } else if (isVisible && !isClosing) {\n      setIsClosing(true);\n      setTimeout(() => {\n        setIsVisible(false);\n        setIsClosing(false);\n      }, 200);\n    }\n  }, [isOpen, defaultValue]);\n\n  const parsedValue = useMemo(() => {\n    const num = parseFloat(localValue) || 0;\n    const whole = Math.floor(num);\n    const decimal = Math.round((num - whole) * Math.pow(10, decimals));\n    return { whole, decimal };\n  }, [localValue, decimals]);\n\n  const wholeNumbers = useMemo(() => {\n    return Array.from({ length: Math.floor((max - min) / step) + 1 }, (_, i) => String(min + i * step));\n  }, [min, max, step]);\n\n  const decimalOptions = useMemo(() => {\n    const options: string[] = [];\n    const step = decimals === 2 ? 1 : 1;\n    for (let i = 0; i < Math.pow(10, decimals); i += step) {\n      options.push(String(i).padStart(decimals, '0'));\n    }\n    return options;\n  }, [decimals]);\n\n  const handleChange = (type: 'whole' | 'decimal', newValue: string) => {\n    let newWhole = parsedValue.whole;\n    let newDecimal = parsedValue.decimal;\n\n    if (type === 'whole') {\n      newWhole = parseInt(newValue);\n    } else {\n      newDecimal = parseInt(newValue);\n    }\n\n    const formatted = `${newWhole}.${String(newDecimal).padStart(decimals, '0')}`;\n    setLocalValue(formatted);\n  };\n\n  const handleDone = () => {\n    onSave(localValue);\n    onClose();\n  };\n\n  if (!isVisible) return null;\n\n  const modal = (\n    <div className=\"fixed inset-0 z-[99999] flex items-center justify-center p-4\">\n      <div\n        className={`absolute inset-0 bg-black/60 ${\n          isClosing\n            ? 'backdrop-fade-out'\n            : 'backdrop-fade-in'\n        }`}\n        style={{ backdropFilter: 'blur(8px)' }}\n        onClick={onClose}\n      />\n\n      <div className=\"relative w-full max-w-sm\">\n        <div\n          className={`relative isolate rounded-2xl border shadow-2xl p-6 max-h-[90vh] overflow-y-auto transition-all ${\n            isDarkMode \n              ? 'border-[#B19CD9]/30 bg-gradient-to-b from-[#1a1625]/95 to-[#0d0a15]/95'\n              : 'border-gray-200 bg-white'\n          } ${\n            isClosing\n              ? 'modal-fade-out'\n              : 'modal-content-fade-in'\n          }`}\n        >\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className={`text-xl font-semibold ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>\n              {label}\n            </h3>\n          </div>\n          <div className={`border-t mb-3 ${isDarkMode ? 'border-[#B19CD9]/20' : 'border-gray-200'}`}></div>\n\n          {presets && presets.length > 0 && (\n            <div className=\"grid grid-cols-4 gap-2 mb-4\">\n              {presets.map((val) => {\n                const isSelected = localValue === val;\n                return (\n                  <button\n                    key={`preset-${val}`}\n                    type=\"button\"\n                    onClick={() => setLocalValue(val)}\n                    className={`px-2 py-1.5 text-xs rounded-lg transition-all duration-300 ${\n                      isSelected\n                        ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white shadow-[0_0_15px_rgba(177,156,217,0.4)]'\n                        : isDarkMode\n                          ? 'bg-[#B19CD9]/10 text-[#B19CD9] border border-[#B19CD9]/30 hover:bg-[#B19CD9]/20'\n                          : 'bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200'\n                    }`}\n                  >\n                    {val}\n                  </button>\n                );\n              })}\n            </div>\n          )}\n\n          <div className=\"flex items-center justify-center gap-3 mb-4 px-2\">\n            <WheelPicker\n              value={String(parsedValue.whole)}\n              onChange={(v) => handleChange('whole', v)}\n              options={wholeNumbers}\n            />\n\n            <span className={`text-2xl font-bold mt-6 ${isDarkMode ? 'text-white' : 'text-gray-900'}`}>.</span>\n\n            <WheelPicker\n              value={String(parsedValue.decimal).padStart(decimals, '0')}\n              onChange={(v) => handleChange('decimal', v)}\n              options={decimalOptions}\n            />\n          </div>\n\n          <div className={`border-t my-3 ${isDarkMode ? 'border-[#B19CD9]/20' : 'border-gray-200'}`}></div>\n\n          <div className=\"flex gap-3\">\n            <button\n              onClick={onClose}\n              className={`flex-1 py-3 rounded-xl border transition-all font-medium ${\n                isDarkMode\n                  ? 'border-[#B19CD9]/40 text-white/80 hover:text-white hover:bg-white/10'\n                  : 'border-gray-300 text-gray-700 hover:bg-gray-100'\n              }`}\n            >\n              Cancel\n            </button>\n\n            <button\n              onClick={handleDone}\n              className=\"flex-1 py-3 rounded-xl bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white font-medium hover:shadow-[0_0_20px_rgba(177,156,217,0.5)] transition-all\"\n            >\n              Done\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n\n  return ReactDOM.createPortal(modal, document.body);\n};\n\nexport default DoseWheelPickerModal;\n","import React from 'react';\r\nimport { ChartPeriod } from '../hooks';\r\nimport { useThemeStyles } from '../../contexts/ThemeContext';\r\n\r\ninterface PeriodSelectorProps {\r\n  value: ChartPeriod;\r\n  onChange: (period: ChartPeriod) => void;\r\n}\r\n\r\nconst PeriodSelector: React.FC<PeriodSelectorProps> = ({ value, onChange }) => {\r\n  const { button } = useThemeStyles();\r\n\r\n  const periods: { value: ChartPeriod; label: string }[] = [\r\n    { value: 'week', label: 'Week' },\r\n    { value: 'month', label: 'Month' },\r\n    { value: '90days', label: '90 Days' },\r\n    { value: 'all', label: 'All Time' },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"flex justify-center mb-3\">\r\n      <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n        {periods.map((period) => (\r\n          <button\r\n            key={period.value}\r\n            onClick={() => onChange(period.value)}\r\n            className={`flex-1 px-2 py-2 text-sm rounded-lg transition-all duration-300 ${\r\n              value === period.value\r\n                ? 'bg-gradient-to-r from-[#B19CD9] to-[#9C7BD3] text-white shadow-[0_0_15px_rgba(177,156,217,0.4)]'\r\n                : 'bg-[#B19CD9]/10 text-[#B19CD9] border border-[#B19CD9]/30 hover:bg-[#B19CD9]/20 hover:shadow-[0_0_10px_rgba(177,156,217,0.3)]'\r\n            }`}\r\n          >\r\n            {period.label}\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PeriodSelector;\r\n","import { UserProfile } from '../../types';\r\n\r\nexport const calculateBMR = (profile: UserProfile, currentWeight: number): number => {\r\n  const { age, gender, height } = profile;\r\n  const weight = currentWeight;\r\n  \r\n  if (gender === 'male') {\r\n    return (10 * weight) + (6.25 * height) - (5 * age) + 5;\r\n  } else {\r\n    return (10 * weight) + (6.25 * height) - (5 * age) - 161;\r\n  }\r\n};\r\n\r\nexport const calculateTDEE = (bmr: number, activityLevel: number): number => {\r\n  return Math.round(bmr * activityLevel);\r\n};\r\n\r\nexport const calculateWeightLossCalories = (weeklyWeightLossKg: number): number => {\r\n  // 1kg of fat = ~7700 calories\r\n  // Daily calorie deficit needed = (7700 * kg) / 7 days\r\n  return Math.round((7700 * weeklyWeightLossKg) / 7);\r\n};\r\n\r\nexport const calculateWeeklyWeightLoss = (dailyCalorieDeficit: number): number => {\r\n  // Reverse calculation: kg per week from daily deficit\r\n  return (dailyCalorieDeficit * 7) / 7700;\r\n};\r\n\r\nexport const calculateMonthlyWeightLoss = (dailyCalorieDeficit: number): number => {\r\n  // 30 days = ~4.29 weeks\r\n  return ((dailyCalorieDeficit * 30) / 7700);\r\n};\r\n\r\n\r\nexport const calculateMedicationConcentration = (\r\n  doses: Array<{ date: Date; dose: number }>,\r\n  halfLifeHours: number,\r\n  currentDate: Date\r\n): number => {\r\n  const ABSORPTION_HOURS = 24;\r\n  \r\n  return doses.reduce((total, dose) => {\r\n    const hoursElapsed = (currentDate.getTime() - dose.date.getTime()) / (1000 * 60 * 60);\r\n    \r\n    if (hoursElapsed < 0) {\r\n      return total;\r\n    }\r\n    \r\n    let effectFactor: number;\r\n    \r\n    if (hoursElapsed < ABSORPTION_HOURS) {\r\n      const absorptionProgress = hoursElapsed / ABSORPTION_HOURS;\r\n      effectFactor = dose.dose * absorptionProgress;\r\n    } else {\r\n      const decayHours = hoursElapsed - ABSORPTION_HOURS;\r\n      const decayFactor = Math.exp(-0.693 * decayHours / halfLifeHours);\r\n      effectFactor = dose.dose * decayFactor;\r\n    }\r\n    \r\n    return total + effectFactor;\r\n  }, 0);\r\n};\r\n\r\nexport const calculateGLP1Concentration = calculateMedicationConcentration;","/**\n * Utility functions for common operations\n */\n\n/**\n * Debounce function to delay function execution\n * @param func Function to debounce\n * @param delay Delay in milliseconds\n * @returns Debounced function\n */\nexport const debounce = <T extends (...args: any[]) => any>(\n  func: T,\n  delay: number\n): ((...args: Parameters<T>) => void) => {\n  let timeoutId: NodeJS.Timeout;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => func(...args), delay);\n  };\n};\n\n/**\n * Check if the device is a mobile device\n * @returns true if mobile device\n */\nexport const isMobile = (): boolean => {\n  if (typeof window === 'undefined') return false;\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;\n};\n\n/**\n * Get animation duration based on device\n * @returns animation duration in milliseconds\n */\nexport const getAnimationDuration = (): number => {\n  return isMobile() ? 0 : 300;\n};"],"names":["MEDICATIONS","id","name","defaultDose","halfLifeHours","titrationDoses","generateId","Math","random","toString","substr","formatDateShort","dateStr","Date","toLocaleDateString","month","day","formatFrequency","frequencyPerWeek","concat","getTodayString","timeService","todayString","_ref","isOpen","onClose","onAddMedication","useWheelForDate","isDarkMode","useTheme","selectedMedication","setSelectedMedication","useState","dose","setDose","selectedDate","setSelectedDate","showDatePicker","setShowDatePicker","showDosePicker","setShowDosePicker","isVisible","setIsVisible","isClosing","setIsClosing","useEffect","lastMed","getLastMedication","lastDoses","getLastDoses","med","find","m","document","body","classList","add","setTimeout","remove","_jsxs","className","children","_jsx","style","backdropFilter","onClick","onSubmit","e","preventDefault","doseValue","parseFloat","saveLastMedication","saveLastDose","type","value","readOnly","placeholder","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","DateWheelPickerModal","onChange","maxDate","CalendarPickerModal","DoseWheelPickerModal","onSave","min","max","label","decimals","defaultValue","map","medId","handleMedicationSelect","INJECTION_AREAS","INJECTION_SIDES","INJECTION_POSITIONS","ISR_SEVERITY","protocol","allMedications","medicationColor","useMemo","medication","length","getMedicationColorByName","painLevel","setPainLevel","injectionArea","setInjectionArea","injectionSide","setInjectionSide","injectionPosition","setInjectionPosition","isr","setIsr","notes","setNotes","currentTime","setCurrentTime","handlePainLevelChange","useCallback","now","nowDate","toLocaleTimeString","hour","minute","painLevelColor","getPainLevelColor","level","today","weekday","year","getInjectionSiteString","parts","push","join","renderSelector","options","selected","onSelect","cols","arguments","undefined","gridTemplateColumns","opt","color","step","parseInt","target","severity","rows","handleSave","todayStr","injectionSite","newEntry","date","isManual","time","addMedicationManualEntry","toLocalDateString","getFullYear","String","getMonth","padStart","getDate","useProtocolForm","mode","existingProtocols","frequency","setFrequency","startDate","setStartDate","stopDate","setStopDate","continuationInfo","setContinuationInfo","phase","setPhase","selectedDurationDays","setSelectedDurationDays","saved","localStorage","getItem","showOtherModal","setShowOtherModal","customMedication","setCustomMedication","savedMedications","setSavedMedications","loadedMeds","loadMedications","mainMeds","filteredMeds","Array","from","Set","p","filter","includes","setItem","JSON","stringify","parsed","parse","savedDuration","durationDays","lastMedName","medData","newDose","newStartDate","continuation","isTitration","medProtocols","lastProtocol","sort","a","b","getTime","lastEndDate","endDate","setDate","lastDoseIndex","indexOf","defaultEndDate","getAllMedicationIds","Boolean","MAIN_MEDICATIONS","_objectSpread","applyMedicationDefaults","medicationId","medName","medicationName","halfLife","startsWith","replace","currentSaved","updated","stopDateValue","resetForm","frequencyOptions","durationPresets","days","_frequencyOptions$fin","onArchive","onDelete","useWheelForNumbers","confirmAction","setConfirmAction","showStartDatePicker","setShowStartDatePicker","showStopDatePicker","setShowStopDatePicker","showSchedulePicker","setShowSchedulePicker","formHandleSave","handleStartDateChange","f","preset","isSelected","handleDurationPreset","_Fragment","newProtocol","handleCustomMedicationAdd","trim","disabled","BottomSheetModal","title","val","Button","variant","size","fullWidth","props","t","o","r","i","n","hasOwnProperty","call","Object","getOwnPropertySymbols","propertyIsEnumerable","_objectWithoutProperties","_excluded","primary","accent","mint","sm","md","lg","memo","CANONICAL_MEDICATIONS","semaglutide","tirzepatide","retatrutide","cagrilintide","MEDICATION_KEYS","normalizeMedName","lower","toLowerCase","key","variants","entries","some","v","MedicationProgressBar","React","medicationEntries","protocols","latestDoseDone","onLogDose","isLogging","stats","activeProtocol","doseLoggedToday","calculateMedicationStats","toLocalDateStr","parseYmd","ymd","y","split","Number","currentTimeDate","filteredProtocols","isArchived","filteredEntries","start","end","intervalDays","round","lastScheduledDate","nextDueDays","nextDueHours","nextDueMinutes","nextDueSeconds","daysSinceLastDose","nextDueDateStr","nextDoseDate","protocolStartDate","todayTimestamp","startTimestamp","todayTimestampMidnight","intervalMs","daysSinceStart","floor","nextDoseTimestamp","lastDoseTimestamp","diffMs","lastDoseDate","lastDoseDateStr","ceil","totalDoses","totalCurrentDose","thisMonthDoses","entry","entryDate","upcomingDoses","nextMonth","setMonth","count","forEach","interval","isScheduleStartDay","isDueToday","perMedStats","computePerMedStats","isOverdue","entryToday","timeDate","todayLocal","medEntries","lastEntry","lastDateLocal","daysDiff","currentDoses","currentLevel","thisMonth","plannedDoses","lastDate","actualDaysSinceLastDose","semaglutideIsOverdue","tirzepatideIsOverdue","retatrutideIsOverdue","cagrilintideIsOverdue","semaglutideEntryToday","tirzepatideEntryToday","retatrutideEntryToday","cagrilintideEntryToday","semaglutideDaysSinceLastDose","tirzepatideDaysSinceLastDose","retatrutideDaysSinceLastDose","cagrilintideDaysSinceLastDose","todayStr2","fallback","collapsedMedications","onToggleMedication","onEditProtocol","onDeleteClick","groupedProtocols","reduce","acc","_ref2","isExpanded","has","index","onAcknowledged","acknowledged","setAcknowledged","animation","checked","handleContinue","onConfirm","boxShadow","splitDosing","setSplitDosing","handleCreate","freqValue","titrationProtocols","titrationDose","phaseStart","phaseEnd","toISOString","useMedicationStats","onRefreshMedications","chartPeriod","onChartPeriodChange","isModalOpen","setIsModalOpen","showLogDoseModal","setShowLogDoseModal","setIsLogging","activeProtocolForModal","setActiveProtocolForModal","setProtocols","getActiveProtocols","editingProtocol","setEditingProtocol","isProtocolModalOpen","setIsProtocolModalOpen","protocolModalMode","setProtocolModalMode","showOfficialScheduleModal","setShowOfficialScheduleModal","showDisclaimer","setShowDisclaimer","deleteConfirmMed","setDeleteConfirmMed","setCollapsedMedications","showProgressDebug","setShowProgressDebug","showOverdueDisclaimer","setShowOverdueDisclaimer","loggingMedicationName","setLoggingMedicationName","setLatestDoseDone","nowTimestamp","useTime","useActiveProtocol","uniqueMedications","medSet","bigCard","bigCardText","smallCard","text","useThemeStyles","generatedEntries","handleGenerateDoses","protocolList","clearMedicationEntries","generateDosesFromProtocols","addMedicationGeneratedEntry","setHours","stop","getMedicationManualEntries","manualEntry","getActiveProtocolForMedication","handleLogDoseNow","targetMed","targetProtocol","statsOverdue","isMedicationOverdue","normalizedName","isNewDay","isNewProtocol","textShadow","totalLossValue","display","justifyContent","alignItems","whiteSpace","percentage","toFixed","MedicationProgressBarContainer","process","PeriodSelector","MedicationChart","data","period","ProtocolList","prev","newSet","delete","handleOpenOfficialSchedule","ProtocolModal","updatedProtocols","saveProtocol","updatedList","archiveProtocol","deleteProtocol","OfficialScheduleModal","newProtocols","saveMedicationProtocols","MedicationModal","LogDoseModal","handleLogDoseSave","OverdueDisclaimerModal","handleConfirmOverdueDose","DeleteConfirmModal","deleteMedicationProtocol","proc","handleDeleteMedication","DisclaimerModal","handleDisclaimerAcknowledged","shortenMedicationName","onLegendChange","chartRef","useRef","medications","medicationColors","dosesByMed","halfLifeByMed","useMedicationChartData","simulatedNow","firstDataDate","lastDataDate","extendedLastDate","futureDays","xAxisDates","todayIndex","zoomStart","zoomEnd","visibleStartIndex","visibleEndIndex","useChartDateRange","chartOption","series","firstDate","doseDatesByMed","doseAmountByMed","combinedDoseDates","combinedDoseAmounts","dateKey","combinedColor","CHART_COLORS","combined","combinedSeries","combinedLineDataBefore","combinedLineDataAfter","combinedDoseData","iterateDate","totalConcentration","calculateMedicationConcentration","isNaN","dateIndex","symbol","symbolSize","itemStyle","borderColor","borderWidth","shadowBlur","shadowColor","smooth","showSymbol","lineStyle","width","areaStyle","x","x2","y2","colorStops","offset","emphasis","opacity","triggerLineEvent","showInLegend","z","scale","s","lastShownValue","dot","shouldShow","abs","formattedDoseValue","show","position","formatter","fontSize","distance","backgroundColor","borderRadius","padding","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","visibleDots","dotIndex","_","slice","lineDataBefore","lineDataAfter","doseData","concentration","flat","markLineConfig","silent","xAxis","todayLineSeries","markLine","generateMedicationSeries","isMobile","tooltip","trigger","extraCssText","textStyle","params","processedParams","seriesType","_p$seriesName","seriesName","dedupedParams","seen","nonZeroParams","_p$value$","_p$value","axisValue","actualDate","dateWithYear","html","item","_item$value$","_item$value","formattedValue","shortName","legend","bottom","icon","itemWidth","itemHeight","dataZoom","zoomOnMouseWheel","moveOnMouseWheel","grid","top","left","right","containLabel","boundaryGap","axisLine","axisTick","axisLabel","splitLine","yAxis","margin","ChartEmptyState","description","ReactECharts","ref","option","height","opts","renderer","onEvents","_chartRef$current","chart","current","getEchartsInstance","dispatchAction","onTodayClick","months","idx","addMonths","scrollRef","isFirstRender","container","middleIndex","middleMonthEl","scrollIntoView","behavior","block","weekDays","textColor","outsideColor","weekdayColor","accentColor","todayColor","renderMonth","monthDate","startOfMonth","endOfMonth","eachDayOfInterval","getMonthDays","startDayOfWeek","getDay","monthLabel","format","isSameDay","isCurrentDay","isToday","isCurrentMonth","isSameMonth","handleDayClick","fontWeight","border","getInitialMonth","currentMonth","setCurrentMonth","currentYear","years","handleClose","timer","clearTimeout","modal","handlePrevMonth","subMonths","newMonth","newYear","handleNextMonth","DatePicker","firstOfMonth","ReactDOM","minDate","localDate","setLocalDate","startYear","endYear","daysInMonth","monthNames","handleChange","newValue","newDay","daysInNewMonth","formatted","WheelPicker","handleDone","presets","localValue","setLocalValue","parsedValue","num","whole","decimal","pow","wholeNumbers","decimalOptions","newWhole","newDecimal","button","calculateBMR","profile","currentWeight","age","gender","calculateTDEE","bmr","activityLevel","doses","currentDate","total","hoursElapsed","effectFactor","absorptionProgress","decayHours","decayFactor","exp","window","test","navigator","userAgent","innerWidth"],"sourceRoot":""}